import{r as l,q as de,j as e,o as ce,L as S,T as R,i as E,k as f,l as h,m as K,n as r,I as $,B as k,S as xe,e as me,f as he,g as je,h as ee,R as qe,s as Me,C as Se,b as Oe,c as Ae,d as $e}from"./index-Dts-ATjR.js";import{L as oe,w as Ue}from"./schemas-Cjj5VgI7.js";function H({message:m,id:p}){return e.jsxs("div",{id:p,className:"flex items-center gap-1 text-sm text-red-600 mt-1",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:m})]})}function We({skus:m,filter:p,value:b,onChange:se,placeholder:te,id:U,error:W}){const c=p?m.filter(N=>N.type===p):m;return e.jsxs(xe,{value:b,onValueChange:se,children:[e.jsx(me,{id:U,className:`h-10 w-full ${W?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!W,"aria-describedby":W?`${U}-error`:void 0,children:e.jsx(he,{placeholder:te})}),e.jsx(je,{children:c.map(N=>e.jsxs(ee,{value:N.id,children:[N.id," — ",N.description]},N.id))})]})}function ue({className:m}){return e.jsx("svg",{className:m,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}function Fe({className:m}){return e.jsx("svg",{className:m,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}function fe({className:m}){return e.jsx("svg",{className:m,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}function _({title:m,icon:p,children:b}){return e.jsxs(Se,{className:"rounded-xl border border-dashed",children:[e.jsx(Oe,{className:"py-4",children:e.jsxs(Ae,{className:"flex items-center gap-2 text-lg",children:[p,m]})}),e.jsx($e,{children:b})]})}function Re({skus:m,layersBySku:p,onUpdateLayers:b,onUpdateSKU:se,onAddMovement:te,woId:U,onRefreshInventory:W}){const[c,N]=l.useState([{id:"1",skuId:"",qty:0,notes:""}]),[q,B]=l.useState([]),[u,G]=l.useState("AUTO"),[w,ae]=l.useState(""),[I,Y]=l.useState(0),[z,ne]=l.useState(""),[P,ie]=l.useState(""),[v,D]=l.useState(null),[x,pe]=l.useState({}),[J,F]=l.useState(!1),X=l.useRef(""),ye=()=>{const s=new Date,t=C=>C.toString().padStart(2,"0"),a=s.getFullYear(),n=t(s.getMonth()+1),d=t(s.getDate()),i=t(s.getHours()),g=t(s.getMinutes());return`${a}${n}${d}${i}${g}`};if(!X.current){const s=Math.random().toString(36).slice(2,6).toUpperCase();X.current=`WO-${ye()}-${s}`}const ge=l.useCallback(()=>{const s=[];x.outputName&&s.push("outputName"),u==="MANUAL"&&x.producedQty&&s.push("producedQty"),c.forEach(t=>{x[`raw-sku-${t.id}`]&&s.push(`raw-sku-${t.id}`),x[`raw-qty-${t.id}`]&&s.push(`raw-qty-${t.id}`)});for(const t of s){const a=document.getElementById(t);if(a){a.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>a.focus&&a.focus(),150);break}}},[x,c,u]),Ne=l.useCallback(()=>{const s=(Math.max(...c.map(t=>parseInt(t.id)),0)+1).toString();N(t=>[...t,{id:s,skuId:"",qty:0,notes:""}])},[c]),ve=l.useCallback(s=>{c.length>1&&N(t=>t.filter(a=>a.id!==s))},[c.length]),Z=l.useCallback((s,t)=>{N(a=>a.map(n=>n.id===s?{...n,...t}:n))},[]),le=l.useCallback(()=>{const s=new Map;c.filter(t=>t.skuId&&t.qty>0).forEach(t=>{const a=s.get(t.skuId)||0;s.set(t.skuId,a+t.qty)}),B(t=>{const a=[];for(const[n,d]of s.entries()){const i=t.find(g=>g.skuId===n);a.push({skuId:n,wasteQty:i?Math.min(i.wasteQty,d):0,maxWaste:d})}return a})},[c]);l.useEffect(()=>{le()},[le]);const we=l.useCallback((s,t)=>{B(a=>a.map(n=>n.skuId===s?{...n,wasteQty:Math.max(0,Math.min(t,n.maxWaste))}:n))},[]),T=l.useMemo(()=>c.reduce((s,t)=>s+(t.qty||0),0),[c]),L=l.useMemo(()=>q.reduce((s,t)=>s+(t.wasteQty||0),0),[q]),O=l.useMemo(()=>Math.max(0,T-L),[T,L]),V=l.useMemo(()=>{const s=c.filter(t=>t.skuId&&t.qty>0).map(t=>m.find(a=>a.id===t.skuId)?.unit).filter(Boolean);return s.length===0||s.every(t=>t===s[0])},[c,m]),y=l.useMemo(()=>{const s=c.filter(t=>t.skuId&&t.qty>0).map(t=>m.find(a=>a.id===t.skuId)?.unit).filter(Boolean);return s.length>1&&!s.every(t=>t===s[0])},[c,m]);l.useEffect(()=>{u==="AUTO"&&Y(O)},[u,O]),l.useEffect(()=>{y&&u==="AUTO"&&G("MANUAL")},[y,u]),l.useEffect(()=>{if(!v)return;const s=t=>{t.key==="Escape"&&D(null)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[v]),l.useEffect(()=>{v&&(async()=>{try{const t=(await de(v)).map(a=>{const n=a.date instanceof Date?a.date:new Date(a.date),d=isNaN(n.getTime())?String(a.date):n.toISOString().split("T")[0];return{id:a.id,date:d,remaining:a.remaining,cost:a.cost}});b&&b(v,t)}catch(s){console.error("Failed to load layers for modal",v,s)}})()},[v,b]),l.useEffect(()=>{if(!J)return;const s=t=>{t.key==="Escape"&&F(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[J]),l.useEffect(()=>{const s={};c.forEach(a=>{const n=`raw-sku-${a.id}`,d=`raw-qty-${a.id}`;if((a.qty||0)>0&&!a.skuId&&(s[n]="SKU is required for this line"),a.skuId&&(a.qty||0)<=0&&(s[d]="Quantity must be greater than 0"),a.skuId&&(a.qty||0)>0){const i=(p[a.skuId]||[]).reduce((g,C)=>g+(C.remaining||0),0);(a.qty||0)>i&&(s[d]="Insufficient stock for this SKU. Receive more in Receiving.")}});const t=new Map;c.filter(a=>a.skuId&&(a.qty||0)>0).forEach(a=>t.set(a.skuId,(t.get(a.skuId)||0)+(a.qty||0)));for(const[a,n]of t.entries()){const d=(p[a]||[]).reduce((i,g)=>i+(g.remaining||0),0);n>d+1e-9&&c.forEach(i=>{i.skuId===a&&(s[`raw-qty-${i.id}`]="Insufficient stock across lines for this SKU.")})}w.trim()||(s.outputName="Finished product name is required"),u==="MANUAL"&&!y&&I<=0&&(s.producedQty="Produced quantity must be greater than 0"),pe(s)},[c,w,u,I,p]);const M=l.useMemo(()=>c.filter(s=>s.skuId&&s.qty>0).map(s=>{const t=p[s.skuId]||[],a=[];let n=s.qty;for(const j of t.slice().sort((o,A)=>new Date(o.date).getTime()-new Date(A.date).getTime())){if(n<=0)break;const o=Math.min(n,j.remaining);a.push({layerId:j.id,qty:o,cost:j.cost}),n-=o}const d=a.reduce((j,o)=>j+Math.round(o.cost*100)*o.qty,0),i=d/100,g=a.reduce((j,o)=>j+o.qty,0),C=g>=s.qty;return{skuId:s.skuId,plan:a,totalCost:i,totalCostCents:d,totalQty:g,canFulfill:C}}),[c,p]),ke=M.reduce((s,t)=>s+t.totalCostCents,0)/100,Q=l.useMemo(()=>{const s=new Map;return q.forEach(t=>s.set(t.skuId,(s.get(t.skuId)||0)+(t.wasteQty||0))),M.map(t=>{const a=t.totalQty,n=a>0?t.totalCostCents/a/100:0,d=Math.min(s.get(t.skuId)||0,a),i=Math.max(0,a-d);return{skuId:t.skuId,qty:i,unitCost:n,value:t.totalCostCents/100}})},[M,q]),be=l.useMemo(()=>Q.reduce((s,t)=>s+t.qty,0),[Q]),Ie=l.useMemo(()=>Q.reduce((s,t)=>s+t.value,0),[Q]),re=l.useMemo(()=>{if(!w.trim()||u==="MANUAL"&&!y&&I<=0||u==="AUTO"&&!V||c.filter(t=>t.skuId&&t.qty>0).length===0)return!1;if(!y){const t=T,a=(u==="AUTO"?O:I)+L;if(Math.abs(t-a)>.01)return!1}for(const t of M)if(!t.canFulfill)return!1;return!0},[w,u,I,V,c,T,L,O,M,y]),Ce=async()=>{if(!w.trim()){alert("Finished product name is required to finalize Work Order");return}if(u==="MANUAL"&&!y&&I<=0){alert("Produced quantity must be greater than 0");return}if(u==="AUTO"&&!V){alert("Cannot use AUTO mode with incompatible units across RAW SKUs");return}const s=c.filter(n=>n.skuId&&n.qty>0);if(s.length===0){alert("Add at least one RAW material line with quantity > 0");return}const t=u==="AUTO"?O:I;if(!y){const n=T,d=t+L;if(Math.abs(n-d)>.01){alert(`Consumption (${n}) must equal production + waste (${d})`);return}}for(const n of M)if(!n.canFulfill){alert(`Insufficient inventory for SKU ${n.skuId}. Required: ${s.filter(d=>d.skuId===n.skuId).reduce((d,i)=>d+i.qty,0)}, Available: ${n.totalQty}`);return}const a=U&&U.trim()?U.trim():X.current;try{const d=c.filter(o=>o.skuId&&o.qty>0).map(o=>({sku:o.skuId,unit:m.find(A=>A.id===o.skuId)?.unit||"",qty:o.qty})),i=q.map(o=>({sku:o.skuId,unit:m.find(A=>A.id===o.skuId)?.unit||"",qty:o.wasteQty})),C=d.map(o=>o.unit).filter(o=>!!o)[0]||"",j={code:a,datetime:new Date().toISOString(),outputName:w.trim(),outputUnit:C,mode:u,outputQty:t,raw:d,waste:i};Ue.parse(j)}catch(n){const d=n?.errors?.[0]?.message||"Invalid Work Order data. Please review the form.";alert(d);return}try{const n=await Me({outputName:w.trim(),outputQuantity:t,rawMaterials:c.filter(i=>i.skuId&&i.qty>0).map(i=>({skuId:i.skuId,quantity:i.qty})),wasteLines:q.filter(i=>i.wasteQty>0).map(i=>({skuId:i.skuId,quantity:i.wasteQty})),date:new Date,reference:a,notes:JSON.stringify({client:z,invoice:P})});alert(`Work Order ${n.workOrderId} finalized successfully!
${t} units of "${w.trim()}" produced.`);const d=Array.from(new Set(c.filter(i=>i.skuId&&i.qty>0).map(i=>i.skuId)));for(const i of d)try{const C=(await de(i)).map(j=>{const o=j.date instanceof Date?j.date:new Date(j.date),A=isNaN(o.getTime())?String(j.date):o.toISOString().split("T")[0];return{id:j.id,date:A,remaining:j.remaining,cost:j.cost}});b&&b(i,C)}catch(g){console.error("Failed to refresh layers for",i,g)}W&&W(),N([{id:"1",skuId:"",qty:0,notes:""}]),B([]),G("AUTO"),ae(""),Y(0),ne(""),ie("")}catch(n){const d=n?.message||"Failed to finalize Work Order. Please try again.";alert(d)}};return e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{title:"Work Order — Finalization",icon:e.jsx(ue,{className:"h-5 w-5 text-slate-500"}),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ce,{children:"WO-00425"}),e.jsx(ce,{variant:"secondary",children:"OPEN"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(S,{className:"text-xs text-slate-500 mb-1.5",children:"1) Raw material consumption (FIFO from oldest layers)"}),e.jsxs("div",{className:"rounded-2xl border border-dashed p-3",children:[e.jsxs(R,{children:[e.jsx(E,{children:e.jsxs(f,{children:[e.jsx(h,{children:"SKU (Raw)"}),e.jsx(h,{children:"Quantity"}),e.jsx(h,{children:"Notes"}),e.jsx(h,{})]})}),e.jsx(K,{children:c.map(s=>e.jsxs(f,{children:[e.jsxs(r,{className:"min-w-[220px]",children:[e.jsx(We,{skus:m,filter:"RAW",value:s.skuId,onChange:t=>Z(s.id,{skuId:t}),placeholder:"Select Raw SKU",id:`raw-sku-${s.id}`,error:x[`raw-sku-${s.id}`]}),x[`raw-sku-${s.id}`]&&e.jsx(H,{id:`raw-sku-${s.id}-error`,message:x[`raw-sku-${s.id}`]})]}),e.jsxs(r,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{id:`raw-qty-${s.id}`,type:"number",min:"0",step:"any",value:s.qty||"",onChange:t=>Z(s.id,{qty:Math.max(0,parseFloat(t.target.value||"0"))}),placeholder:"0","aria-invalid":!!x[`raw-qty-${s.id}`],"aria-describedby":x[`raw-qty-${s.id}`]?`raw-qty-${s.id}-error`:void 0,className:`flex-1 h-10 ${x[`raw-qty-${s.id}`]?"border-red-500 focus:ring-red-500":""}`}),e.jsx("span",{className:"text-xs text-slate-500 min-w-[36px] text-right",children:m.find(t=>t.id===s.skuId)?.unit??""})]}),x[`raw-qty-${s.id}`]&&e.jsx(H,{id:`raw-qty-${s.id}-error`,message:x[`raw-qty-${s.id}`]})]}),e.jsx(r,{children:e.jsx($,{value:s.notes,onChange:t=>Z(s.id,{notes:t.target.value}),placeholder:"e.g., Coil A",className:"h-10"})}),e.jsx(r,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-3 justify-end",children:[e.jsx(k,{variant:"outline",className:"text-green-600 px-0 border-0 hover:bg-transparent",onClick:()=>s.skuId&&D(s.skuId),disabled:!s.skuId,children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(oe,{className:"h-4 w-4 text-green-600"}),"See Raw Layers (balance)"]})}),e.jsx(k,{variant:"outline",onClick:()=>ve(s.id),disabled:c.length<=1,children:"Remove"})]})})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 text-xs text-slate-500",children:[e.jsx("div",{children:"Consumption plan (FIFO) below is auto-calculated."}),e.jsx(k,{size:"sm",variant:"outline",onClick:Ne,children:"Add line"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-xs text-slate-500 mb-1.5",children:"2) Waste"}),e.jsxs("div",{className:"rounded-2xl border border-dashed p-3 space-y-2",children:[q.length===0?e.jsx("p",{className:"text-xs text-slate-500",children:"Waste lines will appear for each RAW SKU with qty > 0."}):e.jsxs(R,{children:[e.jsx(E,{children:e.jsxs(f,{children:[e.jsx(h,{children:"SKU"}),e.jsx(h,{children:"Waste qty"}),e.jsx(h,{children:"Max"})]})}),e.jsx(K,{children:q.map(s=>e.jsxs(f,{children:[e.jsx(r,{children:s.skuId}),e.jsx(r,{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{id:`waste-qty-${s.skuId}`,type:"number",min:"0",step:"any",max:s.maxWaste,value:s.wasteQty||"",onChange:t=>we(s.skuId,Math.max(0,parseFloat(t.target.value||"0"))),placeholder:"0",className:"flex-1 h-10"}),e.jsx("span",{className:"text-xs text-slate-500 min-w-[36px] text-right",children:m.find(t=>t.id===s.skuId)?.unit??""})]})}),e.jsx(r,{className:"text-xs text-slate-500",children:s.maxWaste})]},s.skuId))})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Waste value is calculated via FIFO from the consumed layers per SKU."})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(S,{className:"text-xs text-slate-500 mb-1.5",children:"3) Output"}),e.jsxs("div",{className:"rounded-2xl border border-dashed p-4 grid grid-cols-1 md:grid-cols-12 gap-4",children:[e.jsxs("div",{className:"md:col-span-12 lg:col-span-6",children:[e.jsx(S,{className:"mb-1.5 block",children:"Finished product name *"}),e.jsx($,{id:"outputName",value:w,onChange:s=>ae(s.target.value),placeholder:"e.g., Gasket Kit 50mm",className:`h-10 w-full ${x.outputName?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!x.outputName,"aria-describedby":x.outputName?"outputName-error":void 0}),x.outputName&&e.jsx(H,{id:"outputName-error",message:x.outputName})]}),e.jsxs("div",{className:"md:col-span-6 lg:col-span-3",children:[e.jsx(S,{className:"mb-1.5 block",children:"Output mode"}),e.jsxs(xe,{value:u,onValueChange:s=>G(s),disabled:y,children:[e.jsx(me,{className:"h-10 w-full",children:e.jsx(he,{placeholder:"Mode"})}),e.jsxs(je,{children:[e.jsx(ee,{value:"AUTO",children:"AUTO (Σ RAW - Σ Waste)"}),e.jsx(ee,{value:"MANUAL",children:"MANUAL"})]})]}),y&&e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"Mixed units detected - MANUAL mode required (any quantity allowed)."}),u==="AUTO"&&!V&&!y&&e.jsx("div",{className:"text-xs text-amber-600 mt-1",children:"Units across RAW SKUs differ; AUTO not allowed."})]}),e.jsxs("div",{className:"md:col-span-6 lg:col-span-3",children:[e.jsxs(S,{className:"mb-1.5 block",children:["Produced quantity",u==="MANUAL"&&!y?" *":""]}),e.jsx($,{id:"producedQty",type:"number",value:u==="AUTO"?O:I,onChange:s=>Y(Math.max(0,parseFloat(s.target.value||"0"))),placeholder:"0",className:`h-10 w-full ${x.producedQty?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!x.producedQty,"aria-describedby":x.producedQty?"producedQty-error":void 0,disabled:u==="AUTO"}),u==="MANUAL"&&!y&&x.producedQty&&e.jsx(H,{id:"producedQty-error",message:x.producedQty}),y&&e.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"Mixed units: any quantity allowed."})]}),e.jsxs("div",{className:"md:col-span-12 lg:col-span-6",children:[e.jsx(S,{className:"mb-1.5 block",children:"Client (free text)"}),e.jsx($,{id:"woClient",value:z,onChange:s=>ne(s.target.value),placeholder:"e.g., ACME Corp",className:"h-10 w-full"})]}),e.jsxs("div",{className:"md:col-span-12 lg:col-span-6",children:[e.jsx(S,{className:"mb-1.5 block",children:"Invoice number (free text)"}),e.jsx($,{id:"woInvoice",value:P,onChange:s=>ie(s.target.value),placeholder:"e.g., INV-2025-0001",className:"h-10 w-full"})]})]})]}),e.jsxs("div",{className:"md:col-span-2 flex items-center gap-2",children:[e.jsx(k,{className:"rounded-xl",onClick:()=>F(!0),disabled:!re,children:"Finalize WO"}),!re&&e.jsx(k,{type:"button",variant:"outline",className:"rounded-xl",onClick:ge,children:"Fix errors"}),e.jsx(k,{variant:"outline",className:"rounded-xl",children:"Save draft"})]})]})]}),e.jsx(_,{title:"FIFO breakdown (auto)",icon:e.jsx(Fe,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs(R,{children:[e.jsx(E,{children:e.jsxs(f,{children:[e.jsx(h,{children:"SKU"}),e.jsx(h,{children:"Layer"}),e.jsx(h,{children:"Qty"}),e.jsx(h,{children:"Unit cost"}),e.jsx(h,{children:"Value"})]})}),e.jsxs(K,{children:[M.length===0?e.jsx(f,{children:e.jsx(r,{colSpan:5,className:"text-sm text-slate-500",children:"No consumption planned."})}):M.map(s=>e.jsxs(qe.Fragment,{children:[e.jsx(f,{children:e.jsx(r,{colSpan:5,className:"text-sm text-slate-500",children:s.skuId})}),s.plan.map(t=>e.jsxs(f,{children:[e.jsx(r,{}),e.jsx(r,{children:t.layerId}),e.jsx(r,{children:t.qty}),e.jsxs(r,{children:["$ ",t.cost.toFixed(2)]}),e.jsxs(r,{children:["$ ",(t.qty*t.cost).toFixed(2)]})]},t.layerId)),e.jsxs(f,{children:[e.jsx(r,{className:"font-medium",colSpan:2,children:"Total"}),e.jsx(r,{className:"font-medium",children:s.totalQty}),e.jsx(r,{}),e.jsxs(r,{className:"font-medium",children:["$ ",s.totalCost.toFixed(2)]})]})]},s.skuId)),e.jsxs(f,{children:[e.jsx(r,{className:"font-medium",colSpan:4,children:"Grand Total"}),e.jsxs(r,{className:"font-medium",children:["$ ",ke.toFixed(2)]})]})]})]})}),e.jsx(_,{title:"Validation notes",icon:e.jsx(fe,{className:"h-5 w-5 text-amber-500"}),children:e.jsxs("ul",{className:"text-sm list-disc pl-5 space-y-1 text-slate-600",children:[e.jsx("li",{children:"No negative balance in Raw or Sellable."}),e.jsx("li",{children:"Total consumption = production + waste (WO consistency)."}),e.jsx("li",{children:"Output name is free text and will appear in Movements once you finalize."}),e.jsxs("li",{children:[e.jsx("b",{children:"Sufficient stock:"})," Raw material must have enough inventory to consume."]}),e.jsxs("li",{children:[e.jsx("b",{children:"Produced > 0:"})," Production quantity must be greater than zero."]}),e.jsxs("li",{children:[e.jsx("b",{children:"Output name required:"})," Output name cannot be empty to finalize WO."]})]})})]}),v&&e.jsxs("div",{className:"fixed inset-0 z-50",onClick:()=>D(null),children:[e.jsx("div",{className:"absolute inset-0 bg-black/40"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"font-medium",children:["Raw Layers (balance) — ",v]})]}),e.jsx(k,{variant:"outline",onClick:()=>D(null),children:"✕"})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("p",{className:"text-xs text-slate-600",children:"Note: quantities will be consumed from the oldest inventory layers first (FIFO)."}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(R,{children:[e.jsx(E,{children:e.jsxs(f,{children:[e.jsx(h,{children:"Layer"}),e.jsx(h,{children:"Date"}),e.jsx(h,{children:"Remaining"}),e.jsx(h,{children:"Cost"})]})}),e.jsxs(K,{children:[(p[v]||[]).slice().sort((s,t)=>new Date(s.date).getTime()-new Date(t.date).getTime()).map(s=>e.jsxs(f,{children:[e.jsx(r,{children:s.id}),e.jsx(r,{children:s.date}),e.jsx(r,{children:s.remaining}),e.jsxs(r,{children:["$ ",s.cost.toFixed(2)]})]},s.id)),(p[v]||[]).length===0&&e.jsx(f,{children:e.jsx(r,{colSpan:4,className:"text-sm text-slate-500",children:"No layers for this SKU."})})]})]})})]})]})})]}),J&&e.jsxs("div",{className:"fixed inset-0 z-50",onClick:()=>F(!1),children:[e.jsx("div",{className:"absolute inset-0 bg-black/40"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-slate-500"}),e.jsx("span",{className:"font-medium",children:"Confirm Work Order"})]}),e.jsx(k,{variant:"outline",onClick:()=>F(!1),children:"✕"})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Please review the consumption summary (FIFO) before finalizing."}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(R,{children:[e.jsx(E,{children:e.jsxs(f,{children:[e.jsx(h,{children:"SKU"}),e.jsx(h,{className:"text-right",children:"Quantity"}),e.jsx(h,{className:"text-right",children:"Unit cost"}),e.jsx(h,{className:"text-right",children:"Value"})]})}),e.jsxs(K,{children:[Q.length===0?e.jsx(f,{children:e.jsx(r,{colSpan:4,className:"text-sm text-slate-500",children:"No items to finalize."})}):Q.map(s=>e.jsxs(f,{children:[e.jsx(r,{children:s.skuId}),e.jsx(r,{className:"text-right",children:s.qty}),e.jsxs(r,{className:"text-right",children:["$ ",s.unitCost.toFixed(2)]}),e.jsxs(r,{className:"text-right",children:["$ ",s.value.toFixed(2)]})]},s.skuId)),e.jsxs(f,{children:[e.jsx(r,{className:"font-medium",children:"Totals"}),e.jsx(r,{className:"font-medium text-right",children:be}),e.jsx(r,{}),e.jsxs(r,{className:"font-medium text-right",children:["$ ",Ie.toFixed(2)]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-slate-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Output name:"})," ",e.jsx("b",{children:w||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Produced qty:"})," ",e.jsx("b",{children:u==="AUTO"?O:I})]}),z&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Client:"})," ",e.jsx("b",{children:z})]}),P&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Invoice:"})," ",e.jsx("b",{children:P})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(k,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(k,{onClick:()=>{F(!1),Ce()},children:"Confirm & Finalize"})]})]})]})})]})]})}export{Re as default};
