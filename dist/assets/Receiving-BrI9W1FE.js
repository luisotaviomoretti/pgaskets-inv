import{j as e,R as Oe,r,C as ue,a as Fe,b as me,c as xe,d as he,L as E,I as P,S as Ce,e as Ee,f as De,g as Le,h as pe,B as J,T as qe,i as Ue,k as de,l as se,m as Ae,n as Y,o as Pe,t as Me,p as Qe}from"./index-CA-mNZEK.js";import{L as Ve,r as Ke}from"./schemas-C9OWOqpr.js";const We=({id:s,checked:a,onCheckedChange:l,className:u=""})=>e.jsx("input",{id:s,type:"checkbox",className:`h-4 w-4 rounded border-slate-300 text-slate-900 ${u}`,checked:!!a,onChange:f=>l?.(f.target.checked)}),Ne=Oe.forwardRef(function({className:a="",...l},u){return e.jsx("textarea",{ref:u,className:`min-h-[80px] w-full px-3 py-2 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-400 ${a}`,...l})}),Z=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),Be=s=>{if(!s||!s.trim())return 0;const a=s.replace(/[$,\s]/g,"");if(a==="."||a==="")return 0;const l=parseFloat(a);return isNaN(l)?0:Math.max(0,l)},_e=(s,a)=>{const l=a.find(u=>u.id===s);return l?l.type==="RAW"?"Raw Material":"Sellable Product":""},ze=s=>!s||s<=0?"Quantity must be at least 1.":null,He=s=>!s||s<=0?"Invalid unit cost.":null,Je=s=>!s||s.trim().length<3?"Vendor name must be at least 3 characters.":null,Ze=s=>s?null:"Please select a SKU.",Ge=(s,a=1e3)=>{const l=s.length,u=a-l,f=l>a;return{count:l,remaining:u,isOverLimit:f}};function Xe(s){const{vendorName:a,skuId:l,date:u,existingRefs:f=[]}=s;if(!a||!l||!u)return"";const v=a.trim().toUpperCase().replace(/[^A-Z0-9\s-]/g,"").split(/\s+/).filter(Boolean).map(n=>n[0]).join("").slice(0,3)||"VEN",x=l.trim().toUpperCase().replace(/[^A-Z0-9-]/g,"").slice(0,12),g=u.replace(/-/g,""),p=`PS-${v}-${x}-${g}`,o=(f.filter(n=>n?.startsWith(p)).length||0)+1,T=String(o).padStart(3,"0");return`${p}-${T}`}function Ye(s){return typeof s=="string"?s&&(s.length<=6?"***":`${s.slice(0,6)}***`):s}function be(s){if(!s)return;const a={};for(const[l,u]of Object.entries(s))/vendor|invoice|ref|notes|name|bank|address/i.test(l)?a[l]=Ye(u):a[l]=u;return a}const Se={captureEvent(s,a){console.info("[telemetry:event]",s,be(a))},captureError(s,a,l){console.error("[telemetry:error]",s,be(l),et(a))}};function et(s){if(s instanceof Error)return{message:s.message,stack:s.stack};if(typeof s=="string")return{message:s};try{return{message:JSON.stringify(s)}}catch{return{message:"Unknown error"}}}const ee={event:(s,a)=>Se.captureEvent(s,a),error:(s,a,l)=>Se.captureError(s,a,l)};function tt({value:s,onChange:a,suggestions:l,error:u,id:f}){const[v,x]=r.useState(s||""),[g,p]=r.useState(!1),[o,T]=r.useState([]),[n,k]=r.useState(-1),d=r.useRef(null),R=r.useRef(null),h=`${f}-listbox`;r.useEffect(()=>{x(s||"")},[s]),r.useEffect(()=>{const c=setTimeout(()=>{if(v.trim().length>=3){const m=v.trim().toLowerCase(),w=l.filter(W=>W.name.toLowerCase().includes(m)).slice(0,8);T(w),p(!0),k(w.length>0?0:-1)}else T([]),p(!1),k(-1);a(v)},300);return()=>clearTimeout(c)},[v,l,a]);const M=()=>{setTimeout(()=>p(!1),150)},O=r.useMemo(()=>{const c=o[0]?.name||"";return c.toLowerCase().startsWith((v||"").toLowerCase())?c.slice(v.length):""},[o,v]),U=r.useCallback(c=>{x(c.target.value)},[]),N=r.useCallback(()=>{o.length>0&&p(!0)},[o.length]),Q=r.useCallback(c=>{if(!g&&(c.key==="ArrowDown"||c.key==="ArrowUp")&&p(!0),c.key==="ArrowDown")c.preventDefault(),k(m=>{const w=o.length;return w===0?-1:m<0?0:(m+1)%w});else if(c.key==="ArrowUp")c.preventDefault(),k(m=>{const w=o.length;return w===0?-1:m<=0?w-1:m-1});else if(c.key==="Enter"){if(g){if(c.preventDefault(),n>=0&&o[n]){const m=o[n];x(m.name),p(!1),a(m.name)}else if(o.length===1){const m=o[0];x(m.name),p(!1),a(m.name)}}}else c.key==="Escape"&&g&&(c.preventDefault(),p(!1))},[g,o,n,a]),ne=r.useCallback(c=>{const m=Number.parseInt(c.currentTarget.dataset.index||"-1",10);Number.isNaN(m)||k(m)},[]),K=r.useCallback(c=>{c.preventDefault()},[]),F=r.useCallback(c=>{const m=Number.parseInt(c.currentTarget.dataset.index||"-1",10);if(m>=0&&o[m]){const w=o[m];x(w.name),p(!1),a(w.name),d.current?.focus()}},[o,a]);return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 flex items-center px-3 text-slate-400/60",children:[e.jsx("span",{className:"invisible",children:v}),e.jsx("span",{children:O})]}),e.jsx(P,{id:f,ref:d,value:v,onChange:U,onBlur:M,onFocus:N,onKeyDown:Q,placeholder:"Type vendor name (≥3 chars)...",className:`w-full ${u?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!u,"aria-describedby":u?`${f}-error`:void 0,role:"combobox","aria-autocomplete":"list","aria-controls":h,"aria-expanded":g,"aria-activedescendant":n>=0?`${f}-option-${n}`:void 0}),g&&e.jsx("div",{id:h,role:"listbox","aria-label":"Vendor suggestions",ref:R,className:"absolute z-50 left-0 right-0 mt-1 rounded-xl border bg-white shadow-lg overflow-auto max-h-64",children:o.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-slate-500","aria-live":"polite",children:"No results"}):o.map((c,m)=>e.jsxs("button",{id:`${f}-option-${m}`,role:"option","aria-selected":m===n,type:"button",className:`w-full text-left px-3 py-2 focus:outline-none ${m===n?"bg-slate-100":"hover:bg-slate-50"}`,"data-index":m,onMouseEnter:ne,onMouseDown:K,onClick:F,children:[e.jsx("div",{className:"text-sm font-medium",children:c.name}),(c.address||c.bank)&&e.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[c.address??"",c.address&&c.bank?" • ":"",c.bank??""]})]},c.name))})]})}function st({skus:s,value:a,onChange:l,placeholder:u,error:f,id:v}){return e.jsxs(Ce,{value:a,onValueChange:l,children:[e.jsx(Ee,{id:v,className:`h-10 w-full ${f?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!f,"aria-describedby":f?`${v}-error`:void 0,children:e.jsx(De,{placeholder:u})}),e.jsx(Le,{children:s.map(x=>e.jsxs(pe,{value:x.id,children:[x.id," — ",x.description]},x.id))})]})}function at({className:s}){return e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}function ae({message:s,id:a}){return e.jsxs("div",{id:a,className:"flex items-center gap-1 text-sm text-red-600 mt-1",children:[e.jsx(at,{className:"h-4 w-4"}),e.jsx("span",{children:s})]})}function nt({value:s,onChange:a,error:l,id:u,placeholder:f="$0.00"}){const[v,x]=r.useState(""),[g,p]=r.useState(!1);r.useEffect(()=>{!g&&s>0?x(Z(s)):!g&&s===0&&x("")},[s,g]);const o=k=>{const d=k.target.value;x(d);const R=Be(d);a(R)},T=()=>{p(!0),s>0&&x(s.toString())},n=()=>{p(!1),s>0?x(Z(s)):x("")};return e.jsx(P,{id:u,type:"text",value:v,onChange:o,onFocus:T,onBlur:n,placeholder:f,className:`h-10 ${l?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!l,"aria-describedby":l?`${u}-error`:void 0})}function ke({className:s}){return e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}function we({title:s,icon:a,children:l}){return e.jsxs(ue,{className:"rounded-xl border border-dashed",children:[e.jsx(me,{className:"py-4",children:e.jsxs(xe,{className:"flex items-center gap-2 text-lg",children:[a,s]})}),e.jsx(he,{children:l})]})}function lt({vendors:s,skus:a,layersBySku:l,movements:u,onUpdateLayers:f,onUpdateSKU:v,onAddMovement:x}){const[g,p]=r.useState(()=>new Date().toISOString().split("T")[0]),[o,T]=r.useState(""),[n,k]=r.useState(""),[d,R]=r.useState(0),[h,M]=r.useState(0),[O,U]=r.useState(""),[N,Q]=r.useState(!1),[ne,K]=r.useState(""),[F,c]=r.useState(""),[m,w]=r.useState(!1),[W,q]=r.useState(!1),re=r.useRef(null),[ie,fe]=r.useState([]),I=(t,i="info")=>{const j=`${Date.now()}-${Math.random().toString(36).slice(2,7)}`;fe(L=>[...L,{id:j,message:t,kind:i}]),window.setTimeout(()=>{fe(L=>L.filter($=>$.id!==j))},4e3)};r.useEffect(()=>{if(!W)return;const t=re.current,i=t?.querySelector('[data-modal-initial="true"]'),j=t?.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');(i||j)?.focus();const L=$=>{if(W){if($.key==="Escape"){$.preventDefault(),q(!1);return}if($.key==="Tab"){const te=re.current;if(!te)return;const S=Array.from(te.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(oe=>!oe.hasAttribute("disabled"));if(!S.length)return;const C=document.activeElement;let b=C?S.indexOf(C):-1;$.preventDefault(),$.shiftKey?b=(b-1+S.length)%S.length:b=(b+1)%S.length,S[b]?.focus()}}};return document.addEventListener("keydown",L),()=>document.removeEventListener("keydown",L)},[W]);const[D,B]=r.useState("NONE"),[_,V]=r.useState(0),[y,G]=r.useState({}),A=a.find(t=>t.id===n);r.useEffect(()=>{const t={},i=Je(o);i&&(t.vendor=i);const j=Ze(n);j&&(t.sku=j);const L=ze(d);L&&(t.quantity=L);const $=He(h);$&&(t.unitCost=$),G(t)},[o,n,d,h]),r.useEffect(()=>{V(t=>{const i=Math.max(0,d||0);return Math.max(0,Math.min(t||0,i))})},[d]),r.useEffect(()=>{if(m)return;const t=(u||[]).map(j=>j.ref).filter(Boolean),i=Xe({vendorName:o,skuId:n,date:g,existingRefs:t});i&&O!==i&&U(i)},[o,n,g,u,m]);const ge=r.useMemo(()=>Ge(F),[F]),le=r.useMemo(()=>Object.keys(y).length===0&&o.trim().length>=3&&n&&d>0&&h>0,[y,o,n,d,h]),je=r.useMemo(()=>u?u.filter(t=>t.type==="RECEIVE").sort((t,i)=>new Date(i.datetime).getTime()-new Date(t.datetime).getTime()).slice(0,3):[],[u]),ce=()=>{const t=["date","vendor","sku","quantity","unitCost"];for(const i of t)if(y[i]){document.getElementById(i)?.focus();break}},z=r.useMemo(()=>{const t=Math.max(0,d||0);if(!N||D==="NONE")return{acceptQty:t,wasteQty:0};if(D==="FULL")return{acceptQty:0,wasteQty:t};const i=Math.max(0,Math.min(_||0,t));return{acceptQty:Math.max(0,t-i),wasteQty:i}},[N,D,d,_]),[ve,ye]=r.useState(!1),Te=async()=>{if(!le){ce();return}const t=O||`PS-${Date.now()}`,{acceptQty:i,wasteQty:j}=z;if(ee.event("receiving_submit_attempt",{sku:n,qty:i,unitCost:h,vendor:o,isDamaged:N,damageScope:D,ref:t}),N&&D==="FULL"){x?.({datetime:new Date().toISOString().replace("T"," ").substring(0,16),type:"WASTE",skuOrName:n,qty:-j,value:-(j*h),ref:`${t}-FULL-REJECT`}),I(`Packing slip fully rejected. ${j} units registered as waste.`,"info"),k(""),R(0),M(0),U(""),Q(!1),B("NONE"),V(0),c(""),q(!1);return}if(i<=0){I("No quantity to accept (all rejected)","error"),q(!1);return}let L;try{const S=Me(o),C=A?.unit||"";L={vendorId:S,invoice:t,datetime:new Date(`${g}T00:00:00Z`).toISOString(),lines:[{sku:n,unit:C,qty:i,unitCost:h}],notes:F?.trim()||void 0,isDamaged:N,damageScope:D,rejectedQty:N?_:void 0},Ke.parse(L)}catch(S){const C=S?.issues,b={};if(C&&Array.isArray(C))for(const H of C){const X=H.path.join(".");X.startsWith("lines.0.qty")?b.quantity=H.message:X.startsWith("lines.0.unitCost")?b.unitCost=H.message:X.startsWith("lines.0.sku")?b.sku=H.message:X==="vendorId"?b.vendor=H.message:X==="datetime"&&(b.date=H.message)}Object.keys(b).length>0&&G(b);const oe=C?.[0]?.message||"Invalid receiving data. Please review the form.";I(oe,"error"),ce(),q(!1);return}const te={id:`${n}-L${Date.now()}`,date:new Date().toISOString().split("T")[0],remaining:i,cost:h};try{ye(!0),await Qe({skuId:n,quantity:i,unitCost:h,date:new Date(g),vendorName:o,packingSlipNo:t,notes:F?.trim()||void 0});const C=[...l[n]||[],te];f?.(n,C);const b=A?.onHand||0;v?.(n,{onHand:b+i}),x?.({datetime:new Date().toISOString().replace("T"," ").substring(0,16),type:"RECEIVE",skuOrName:n,qty:i,value:i*h,ref:t}),N&&D==="PARTIAL"&&j>0&&x?.({datetime:new Date().toISOString().replace("T"," ").substring(0,16),type:"WASTE",skuOrName:n,qty:-j,value:-(j*h),ref:`${t}-REJECTED`}),I(`Successfully approved! ${i} units added to inventory.`,"success"),ee.event("receiving_submit_success",{sku:n,acceptQty:i,wasteQty:j,unitCost:h,ref:t}),p(new Date().toISOString().split("T")[0]),T(""),k(""),R(0),M(0),U(""),Q(!1),K(""),B("NONE"),V(0),c(""),G({}),q(!1)}catch(S){const C=S?.message||"Failed to submit receiving. Please try again.";I(C,"error"),ee.error("receiving_submit_failed",S,{sku:n,acceptQty:i,unitCost:h,ref:t}),q(!1);return}finally{ye(!1)}},$e=()=>{if(!le){ce();return}q(!0)},Ie=()=>{if(!n||d<=0){I("Please fill in SKU and quantity first","error");return}ee.event("receiving_full_reject",{sku:n,qty:d,unitCost:h,ref:`${O||`PS-${Date.now()}`}-FULL-REJECT`}),x?.({datetime:new Date().toISOString().replace("T"," ").substring(0,16),type:"WASTE",skuOrName:n,qty:-d,value:-(d*(h||0)),ref:`${O||`PS-${Date.now()}`}-FULL-REJECT`}),I(`Entire packing slip rejected! ${d} units marked as waste.`,"info"),p(new Date().toISOString().split("T")[0]),T(""),k(""),R(0),M(0),U(""),Q(!1),B("NONE"),V(0),c(""),G({})},Re=()=>{if(!n||d<=0){I("Please fill in SKU and quantity first","error");return}if(!o.trim()){I("Please select a vendor first","error");return}const t=O||`PS-${Date.now()}`;ee.event("receiving_return_to_vendor",{sku:n,qty:d,unitCost:h,vendor:o,ref:t}),x?.({datetime:new Date().toISOString().replace("T"," ").substring(0,16),type:"WASTE",skuOrName:n,qty:-d,value:-(d*(h||0)),ref:`${t}-RETURN-TO-VENDOR`}),I(`${d} units of ${n} returned to vendor: ${o}`,"info"),p(new Date().toISOString().split("T")[0]),T(""),k(""),R(0),M(0),U(""),Q(!1),K(""),B("NONE"),V(0),c(""),G({})};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"sr-only","aria-live":"polite",children:ie.slice(-1).map(t=>e.jsx("span",{children:t.message},t.id))}),ie.length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-[60] space-y-2",children:ie.map(t=>e.jsx("div",{role:"status",className:`rounded-lg shadow-lg px-3 py-2 text-sm ring-1 ${t.kind==="error"?"bg-red-600 text-white ring-red-700":t.kind==="success"?"bg-emerald-600 text-white ring-emerald-700":"bg-slate-800 text-white ring-slate-900"}`,children:t.message},t.id))}),e.jsxs(ue,{className:"max-w-3xl mx-auto",children:[e.jsx(me,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 text-slate-500"}),"Receiving Form"]})}),e.jsx(he,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 md:gap-6",children:[e.jsxs("div",{className:"col-span-12 md:col-span-3 space-y-2",children:[e.jsx(E,{htmlFor:"date",className:"text-sm font-medium",children:"Date"}),e.jsx(P,{id:"date",type:"date",value:g,onChange:t=>p(t.target.value),className:"h-10",placeholder:"mm/dd/yyyy"})]}),e.jsxs("div",{className:"col-span-12 md:col-span-9 space-y-2",children:[e.jsx(E,{htmlFor:"vendor",className:"text-sm font-medium",children:"Vendor *"}),e.jsx(tt,{id:"vendor",value:o,onChange:T,suggestions:s,error:y.vendor}),y.vendor&&e.jsx(ae,{message:y.vendor,id:"vendor-error"})]}),e.jsxs("div",{className:"col-span-12 md:col-span-6 space-y-2 mt-6",children:[e.jsx(E,{htmlFor:"sku",className:"text-sm font-medium",children:"SKU *"}),e.jsx(st,{id:"sku",skus:a,value:n,onChange:k,placeholder:"Select SKU",error:y.sku}),y.sku&&e.jsx(ae,{message:y.sku,id:"sku-error"})]}),e.jsxs("div",{className:"col-span-12 md:col-span-6 space-y-2 mt-6",children:[e.jsx(E,{htmlFor:"type",className:"text-sm font-medium",children:"Type"}),e.jsx(P,{id:"type",value:A?_e(A.id,a):"",className:"h-10 bg-slate-50",placeholder:"Automatically set from SKU",readOnly:!0,"aria-disabled":"true",title:"Auto from SKU"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Automatically set from SKU"})]}),e.jsxs("div",{className:"col-span-12 md:col-span-4 space-y-2 mt-6",children:[e.jsxs(E,{htmlFor:"quantity",className:"text-sm font-medium",children:["Quantity",A?.unit?` (${A.unit})`:""," *"]}),e.jsx(P,{id:"quantity",type:"number",step:"any",min:"0",value:d||"",onChange:t=>{const i=Number.isNaN(parseFloat(t.target.value))?0:parseFloat(t.target.value);R(Math.max(0,i))},className:`h-10 ${y.quantity?"border-red-500 focus:ring-red-500":""}`,placeholder:"0","aria-invalid":!!y.quantity,"aria-describedby":y.quantity?"quantity-error":void 0}),y.quantity&&e.jsx(ae,{message:y.quantity,id:"quantity-error"})]}),e.jsxs("div",{className:"col-span-12 md:col-span-4 space-y-2 mt-6",children:[e.jsx(E,{htmlFor:"unitCost",className:"text-sm font-medium",children:"Unit cost *"}),e.jsx(nt,{id:"unitCost",value:h,onChange:M,error:y.unitCost,placeholder:"$0.00"}),y.unitCost&&e.jsx(ae,{message:y.unitCost,id:"unitCost-error"})]}),e.jsx("div",{className:"col-span-12 md:col-span-4 mt-6"})," ",e.jsxs("div",{className:"col-span-12 md:col-span-8 space-y-2 mt-6",children:[e.jsx(E,{htmlFor:"packingSlip",className:"text-sm font-medium",children:"Packing slip (No.)"}),e.jsx(P,{id:"packingSlip",value:O,onChange:t=>{U(t.target.value),w(!!t.target.value)},className:"h-10",placeholder:"PS-2025-0001"})]}),e.jsx("div",{className:"col-span-12 md:col-span-4 flex items-end pb-2 mt-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(We,{id:"damaged",checked:N,onCheckedChange:t=>{const i=!!t;Q(i),B(i?"FULL":"NONE"),i||(V(0),K(""))}}),e.jsx(E,{htmlFor:"damaged",className:"text-sm font-medium cursor-pointer",children:"Damaged?"})]})}),N&&e.jsxs("div",{className:"col-span-12 space-y-2 mt-6",children:[e.jsx(E,{htmlFor:"damageDescription",className:"text-sm font-medium",children:"Damage description"}),e.jsx(Ne,{id:"damageDescription",value:ne,onChange:t=>K(t.target.value),placeholder:"Describe the damage...",className:"min-h-[80px]"})]}),N&&e.jsxs("div",{className:"col-span-12 grid grid-cols-1 md:grid-cols-3 gap-3 mt-6",children:[e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium",children:"Damage scope"}),e.jsxs(Ce,{value:D,onValueChange:t=>B(t),children:[e.jsx(Ee,{className:"h-10 w-full",children:e.jsx(De,{placeholder:"Select"})}),e.jsxs(Le,{children:[e.jsx(pe,{value:"FULL",children:"Entire packing slip"}),e.jsx(pe,{value:"PARTIAL",children:"Partial"})]})]})]}),D==="PARTIAL"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs(E,{className:"text-sm font-medium",children:["Rejected qty",A?.unit?` (${A.unit})`:""]}),e.jsx(P,{type:"number",step:"any",min:0,max:d,value:_,onChange:t=>{const i=Number.isNaN(parseFloat(t.target.value))?0:parseFloat(t.target.value);V(Math.max(0,Math.min(i,d)))},className:"h-10"})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium",children:"Accepted qty"}),e.jsx(P,{value:Math.max(0,z.acceptQty),readOnly:!0,className:"h-10 bg-slate-50"})]})]})]}),N&&e.jsx("div",{className:"col-span-12 mt-4",children:e.jsx("p",{className:"text-xs text-amber-700 bg-amber-50 p-2 rounded",children:D==="FULL"?"The entire packing slip will be rejected (no inventory entry).":"Partial damage: the rejected quantity will not enter inventory."})}),e.jsxs("div",{className:"col-span-12 space-y-2 mt-6",children:[e.jsx(E,{htmlFor:"notes",className:"text-sm font-medium",children:"Notes"}),e.jsx(Ne,{id:"notes",value:F,onChange:t=>c(t.target.value),placeholder:"Inspection notes",className:"min-h-[120px]",maxLength:1e3}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500",children:[e.jsx("span",{children:"Optional"}),e.jsxs("span",{className:ge.isOverLimit?"text-red-500":"",children:[ge.count,"/1000 characters"]})]})]})]})}),W&&Fe.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50",role:"presentation",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30","aria-hidden":"true",onClick:()=>q(!1)}),e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-[min(100%,560px)]",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-receiving-title",ref:re,children:e.jsxs(ue,{className:"rounded-2xl shadow-2xl bg-white ring-1 ring-black/10",children:[e.jsx(me,{children:e.jsx(xe,{id:"confirm-receiving-title",children:"Confirm receiving"})}),e.jsxs(he,{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Date:"})," ",g]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Vendor:"})," ",o||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Packing Slip:"})," ",O||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"SKU:"})," ",n||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Accepted qty:"})," ",Math.max(0,z.acceptQty)]}),N&&z.wasteQty>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Rejected qty:"})," ",z.wasteQty]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Unit cost:"})," ",Z(h||0)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Total value:"})," ",Z(Math.max(0,z.acceptQty)*(h||0))]})]}),F?.trim()&&e.jsxs("div",{className:"text-xs text-slate-700",children:["Notes: ",F.trim()]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(J,{variant:"outline",onClick:()=>q(!1),"data-modal-initial":"true",children:"Cancel"}),e.jsx(J,{onClick:Te,disabled:ve,children:ve?"Submitting…":"Confirm & submit"})]})]})]})})]}),document.body),e.jsx("div",{className:"sticky bottom-0 bg-white border-t p-4",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(J,{variant:"outline",type:"button",children:"Cancel"}),N&&D==="FULL"?e.jsxs(e.Fragment,{children:[e.jsx(J,{variant:"destructive",onClick:Ie,children:"Reject entire packing slip"}),e.jsx(J,{variant:"outline",onClick:Re,disabled:!o.trim()||d<=0,children:"Return to vendor"})]}):e.jsx(J,{onClick:$e,disabled:!le,className:"min-w-[200px]",children:N&&D==="PARTIAL"?`Approve partial (${Math.max(0,d-_)} in, ${_} out)`:"Approve & add to inventory"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(we,{title:"Recent RAW layers (FIFO)",icon:e.jsx(Ve,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs(qe,{children:[e.jsx(Ue,{children:e.jsxs(de,{children:[e.jsx(se,{children:"Layer ID"}),e.jsx(se,{children:"Date"}),e.jsx(se,{children:"Remaining qty"}),e.jsx(se,{children:"Unit cost"})]})}),e.jsxs(Ae,{children:[(l[n]||[]).slice(0,3).map(t=>e.jsxs(de,{children:[e.jsx(Y,{children:t.id}),e.jsx(Y,{children:typeof t.date=="string"?t.date:new Date(t.date).toLocaleDateString()}),e.jsx(Y,{children:t.remaining}),e.jsx(Y,{children:Z(t.cost)})]},t.id)),(!n||(l[n]||[]).length===0)&&e.jsx(de,{children:e.jsx(Y,{colSpan:4,className:"text-sm text-slate-500",children:"Select a SKU to view its recent layers."})})]})]})})}),e.jsx("div",{className:"space-y-4",children:e.jsx(we,{title:"Recent submissions",icon:e.jsx(ke,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs("div",{className:"space-y-2",children:[je.map((t,i)=>e.jsxs("div",{className:"p-3 rounded-xl border border-dashed",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[t.ref," — ",t.skuOrName]}),e.jsx(Pe,{variant:"secondary",children:"RECEIVED"})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[new Date(t.datetime).toLocaleDateString()," • ",t.qty," units • ",Z(t.value)]})]},`${t.datetime}-${i}`)),je.length===0&&e.jsx("div",{className:"p-3 rounded-xl border border-dashed",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No recent submissions."})})]})})})]})]})}export{lt as default};
