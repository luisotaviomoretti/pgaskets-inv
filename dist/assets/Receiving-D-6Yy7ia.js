import{R as Se,j as e,r as a,p as Fe,C as V,a as je,b as P,c as T,d as A,L as S,I as E,B as ve,e as w,T as Ne,f as ye,g as C,h as k,i as be,k as g,S as se,l as te,m as ae,n as ie,o as re,q as Re}from"./index-B8usHSND.js";import{M as Me,L as Ve}from"./schemas-DjjCq7Li.js";const ke=Se.forwardRef(function({className:c="",...o},x){return e.jsx("textarea",{ref:x,className:`min-h-[80px] w-full px-3 py-2 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-400 ${c}`,...o})}),Pe=({className:i="",viewportClassName:c="",children:o,...x})=>e.jsx("div",{className:`relative overflow-hidden ${i}`,...x,children:e.jsx("div",{className:`overflow-auto ${c}`,children:o})}),B=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(i),Te=i=>{if(!i||!i.trim())return 0;const c=i.replace(/[$,\s]/g,"");if(c==="."||c==="")return 0;const o=parseFloat(c);return isNaN(o)?0:Math.max(0,o)},Ae=(i,c=1e3)=>{const o=i.length,x=c-o,u=o>c;return{count:o,remaining:x,isOverLimit:u}};function Be(i){const{vendorName:c,date:o,existingRefs:x=[]}=i;if(!c||!o)return"";const u=c.trim().toUpperCase().replace(/[^A-Z0-9\s-]/g,"").split(/\s+/).filter(Boolean).map(p=>p[0]).join("").slice(0,3)||"VEN",N=o.replace(/-/g,""),h=`PS-${u}-BATCH-${N}`,v=(x.filter(p=>p?.startsWith(h)).length||0)+1,y=String(v).padStart(3,"0");return`${h}-${y}`}function Oe({value:i,onChange:c,suggestions:o,error:x,id:u}){const[N,h]=a.useState(!1),[v,y]=a.useState(""),p=o.some(j=>j.name===i);return a.useEffect(()=>{!p&&i&&(h(!0),y(i))},[i,p]),N?e.jsxs("div",{className:"flex items-center gap-1 h-10 w-full max-w-full min-w-0",children:[e.jsx(E,{id:u,value:v,onChange:j=>{y(j.target.value),c(j.target.value)},placeholder:"Enter vendor...",className:`flex-1 h-full min-w-0 ${x?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!x,"aria-describedby":x?`${u}-error`:void 0}),e.jsx(w,{type:"button",variant:"outline",size:"sm",onClick:()=>{h(!1),y(""),c("")},className:"px-1 h-full text-xs shrink-0 min-w-0 w-6",title:"Select from list",children:"↓"})]}):e.jsxs("div",{className:"flex items-center gap-1 h-10 w-full max-w-full min-w-0",children:[e.jsxs(se,{value:i,onValueChange:c,children:[e.jsx(te,{id:u,className:`flex-1 h-full min-w-0 ${x?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!x,"aria-describedby":x?`${u}-error`:void 0,children:e.jsx(ae,{placeholder:"Select vendor..."})}),e.jsx(ie,{className:"max-h-64",children:o.map(j=>e.jsx(re,{value:j.name,children:e.jsx("span",{className:"font-medium",children:j.name})},j.name))})]}),e.jsx(w,{type:"button",variant:"outline",size:"sm",onClick:()=>{h(!0),y(i)},className:"px-1 h-full text-xs shrink-0 min-w-0 w-6",title:"Enter custom vendor",children:"+"})]})}function Ue({skus:i,value:c,onChange:o,placeholder:x,error:u,id:N}){return e.jsxs(se,{value:c,onValueChange:o,children:[e.jsx(te,{id:N,className:`h-10 w-full ${u?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!u,"aria-describedby":u?`${N}-error`:void 0,children:e.jsx(ae,{placeholder:x})}),e.jsx(ie,{children:i.map(h=>e.jsxs(re,{value:h.id,children:[h.id," — ",h.description]},h.id))})]})}function H({className:i}){return e.jsx("svg",{className:i,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}function Qe({message:i,id:c}){return e.jsxs("div",{id:c,className:"flex items-center gap-1 text-sm text-red-600 mt-1",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{children:i})]})}function Ke({value:i,onChange:c,error:o,id:x,placeholder:u="$0.00"}){const[N,h]=a.useState(""),[v,y]=a.useState(!1);a.useEffect(()=>{!v&&i>0?h(B(i)):!v&&i===0&&h("")},[i,v]);const p=O=>{const I=O.target.value;h(I);const Y=Te(I);c(Y)},j=()=>{y(!0),i>0&&h(i.toString())},W=()=>{y(!1),i>0?h(B(i)):h("")};return e.jsx(E,{id:x,type:"text",value:N,onChange:p,onFocus:j,onBlur:W,placeholder:u,className:`h-9 w-full ${o?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!o,"aria-describedby":o?`${x}-error`:void 0})}function we({className:i}){return e.jsx("svg",{className:i,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}function ze({title:i,icon:c,children:o}){return e.jsxs(V,{className:"rounded-xl border border-dashed",children:[e.jsx(P,{className:"py-4",children:e.jsxs(T,{className:"flex items-center gap-2 text-lg",children:[c,i]})}),e.jsx(A,{children:o})]})}function He({className:i}){return e.jsx("svg",{className:i,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}function os({vendors:i,skus:c,layersBySku:o,movements:x,onUpdateLayers:u,onUpdateSKU:N,onAddMovement:h}){const[v,y]=a.useState(""),[p,j]=a.useState([]),[W,O]=a.useState(!1),[I,Y]=a.useState(!1);a.useEffect(()=>{if(!v){j([]);return}(async()=>{O(!0);try{const t=await Re(v);j(t||[])}catch(t){console.error("Failed to fetch FIFO layers:",t),j([])}finally{O(!1)}})()},[v]);const[m,U]=a.useState([{id:"1",skuId:"",qty:0,unitCost:0,notes:""}]),[d,b]=a.useState({date:new Date().toISOString().split("T")[0],vendor:"",packingSlip:"",isDamaged:!1,damageDescription:"",globalNotes:""}),[We,Ye]=a.useState(()=>new Date().toISOString().split("T")[0]),[ne,Ze]=a.useState(""),[Z,Ge]=a.useState(""),[D,Je]=a.useState(0),[le,Xe]=a.useState(0),[_e,es]=a.useState(""),[ce,ss]=a.useState(!1),[ts,as]=a.useState(""),[de,is]=a.useState(""),[G,oe]=a.useState(!1),[Q,F]=a.useState(!1),J=a.useRef(null),[X,xe]=a.useState([]),L=(s,t="info")=>{const l=`${Date.now()}-${Math.random().toString(36).slice(2,7)}`;xe(n=>[...n,{id:l,message:s,kind:t}]),window.setTimeout(()=>{xe(n=>n.filter(r=>r.id!==l))},4e3)},Ce=a.useCallback(()=>{const s=`${Date.now()}-${Math.random().toString(36).slice(2,7)}`;U(t=>[...t,{id:s,skuId:"",qty:0,unitCost:0,notes:""}])},[]),$e=a.useCallback(s=>{m.length>1&&U(t=>t.filter(l=>l.id!==s))},[m.length]),K=a.useCallback((s,t)=>{U(l=>l.map(n=>n.id===s?{...n,...t}:n))},[]);a.useCallback((s,t)=>{b(l=>({...l,[s]:t}))},[]);const[R,me]=a.useState(!1),[he,ue]=a.useState([]),[Ie,_]=a.useState(!1),z=a.useCallback(()=>{const s={};d.vendor.trim()||(s.vendor="Vendor is required"),d.date||(s.date="Date is required"),m.forEach((l,n)=>{l.skuId||(s[`line-${l.id}-sku`]="SKU is required"),l.qty<=0&&(s[`line-${l.id}-qty`]="Quantity must be greater than 0"),l.unitCost<=0&&(s[`line-${l.id}-cost`]="Unit cost must be greater than 0")});const t=m.reduce((l,n)=>(n.skuId&&(l[n.skuId]=(l[n.skuId]||0)+1),l),{});return Object.entries(t).forEach(([l,n])=>{n>1&&m.forEach(r=>{r.skuId===l&&(s[`line-${r.id}-duplicate`]="Duplicate SKU detected")})}),s},[m,d]),De=a.useCallback(async()=>{const s=z();if(Object.keys(s).length>0){L("Please fix validation errors before processing","error");return}me(!0),ue([]);const t=[];try{for(const r of m)try{await Fe({skuId:r.skuId,quantity:r.qty,unitCost:r.unitCost,date:new Date(d.date),vendorName:d.vendor,packingSlipNo:d.packingSlip||void 0,notes:`${d.globalNotes} ${r.notes}`.trim()||void 0}),t.push({line:r,success:!0}),L(`✓ ${r.skuId} received successfully`,"success")}catch($){t.push({line:r,success:!1,error:$.message||"Processing failed"}),L(`✗ ${r.skuId} failed: ${$.message}`,"error")}ue(t),_(!0);const l=t.filter(r=>r.success).length,n=t.length;l===n?(L(`All ${n} items processed successfully!`,"success"),U([{id:"1",skuId:"",qty:0,unitCost:0,notes:""}]),b(r=>({...r,globalNotes:"",packingSlip:""}))):L(`${l}/${n} items processed successfully`,"info")}finally{me(!1)}},[m,d,z,L,u,N]);a.useEffect(()=>{if(!Q)return;const s=J.current,t=s?.querySelector('[data-modal-initial="true"]'),l=s?.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');(t||l)?.focus();const n=r=>{if(Q){if(r.key==="Escape"){r.preventDefault(),F(!1);return}if(r.key==="Tab"){const $=J.current;if(!$)return;const q=Array.from($.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(Ee=>!Ee.hasAttribute("disabled"));if(!q.length)return;const pe=document.activeElement;let M=pe?q.indexOf(pe):-1;r.preventDefault(),r.shiftKey?M=(M-1+q.length)%q.length:M=(M+1)%q.length,q[M]?.focus()}}};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[Q]);const[ee,rs]=a.useState("NONE"),[ge,Le]=a.useState(0),[f,qe]=a.useState({});c.find(s=>s.id===Z),a.useEffect(()=>{const s=z();qe(s)},[z]),a.useEffect(()=>{Le(s=>{const t=Math.max(0,D||0);return Math.max(0,Math.min(s||0,t))})},[D]),a.useEffect(()=>{if(G||!d.vendor.trim()||!d.date||!m.some(n=>n.skuId&&n.qty>0))return;const t=(x||[]).map(n=>n.ref).filter(Boolean),l=Be({vendorName:d.vendor,date:d.date,existingRefs:t});l&&l!==d.packingSlip&&b(n=>({...n,packingSlip:l}))},[d.vendor,d.date,m,x,G]),a.useMemo(()=>Ae(de),[de]),a.useMemo(()=>Object.keys(f).length===0&&ne.trim().length>=3&&Z&&D>0&&le>0,[f,ne,Z,D,le]);const fe=a.useMemo(()=>x?x.filter(s=>s.type==="RECEIVE").sort((s,t)=>new Date(t.datetime).getTime()-new Date(s.datetime).getTime()).slice(0,3):[],[x]);a.useMemo(()=>{const s=Math.max(0,D||0);if(!ce||ee==="NONE")return{acceptQty:s,wasteQty:0};if(ee==="FULL")return{acceptQty:0,wasteQty:s};const t=Math.max(0,Math.min(ge||0,s));return{acceptQty:Math.max(0,s-t),wasteQty:t}},[ce,ee,D,ge]);const[ns,ls]=a.useState(!1);return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"sr-only","aria-live":"polite",children:X.slice(-1).map(s=>e.jsx("span",{children:s.message},s.id))}),X.length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-[60] space-y-2",children:X.map(s=>e.jsx("div",{role:"status",className:`rounded-lg shadow-lg px-3 py-2 text-sm ring-1 ${s.kind==="error"?"bg-red-600 text-white ring-red-700":s.kind==="success"?"bg-emerald-600 text-white ring-emerald-700":"bg-slate-800 text-white ring-slate-900"}`,children:s.message},s.id))}),e.jsxs(V,{className:"max-w-7xl mx-auto",children:[e.jsx(P,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5 text-slate-500"}),"Multi-SKU Receiving Form"]})}),e.jsxs(A,{className:"p-6 space-y-6",children:[e.jsx("div",{className:"w-full p-4 bg-slate-50 rounded-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3 w-full",children:[e.jsxs("div",{className:"flex flex-col space-y-2 lg:w-[22%] min-w-0",children:[e.jsx(S,{htmlFor:"shared-date",className:"text-sm font-medium text-slate-700",children:"Date"}),e.jsx(E,{id:"shared-date",type:"date",value:d.date,onChange:s=>b(t=>({...t,date:s.target.value})),className:"h-10 w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 lg:w-[40%] min-w-0 max-w-[40%]",children:[e.jsx(S,{htmlFor:"shared-vendor",className:"text-sm font-medium text-slate-700",children:"Vendor *"}),e.jsx("div",{className:"h-10 w-full min-w-0 overflow-hidden",children:e.jsx(Oe,{id:"shared-vendor",value:d.vendor,onChange:s=>b(t=>({...t,vendor:s})),suggestions:i,error:f.vendor})}),f.vendor&&e.jsx(Qe,{message:f.vendor,id:"shared-vendor-error"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 lg:w-[20%] min-w-0",children:[e.jsx(S,{htmlFor:"shared-packing-slip",className:"text-sm font-medium text-slate-700",children:"Packing Slip"}),e.jsxs("div",{className:"relative h-10 w-full",children:[e.jsx(E,{id:"shared-packing-slip",value:d.packingSlip,onChange:s=>{b(t=>({...t,packingSlip:s.target.value})),oe(!0)},onFocus:()=>{d.packingSlip||oe(!1)},className:"h-10 w-full pr-12",placeholder:"Auto-generated or manual"}),!G&&d.packingSlip&&e.jsx("div",{className:"absolute right-1 top-1/2 -translate-y-1/2",children:e.jsx(ve,{variant:"secondary",className:"text-xs px-1 py-0.5",children:"Auto"})})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 lg:w-[18%] min-w-0",children:[e.jsx(S,{className:"text-sm font-medium text-slate-700",children:"Damage Status"}),e.jsxs("div",{className:"flex items-center h-10 px-3 border rounded-md bg-white w-full",children:[e.jsx("input",{id:"shared-damaged",type:"checkbox",checked:d.isDamaged,onChange:s=>b(t=>({...t,isDamaged:s.target.checked})),className:"rounded mr-2"}),e.jsx(S,{htmlFor:"shared-damaged",className:"text-sm cursor-pointer truncate",children:"Items damaged"})]})]})]})}),d.isDamaged&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"shared-damage-desc",className:"text-sm font-medium",children:"Damage Description"}),e.jsx(ke,{id:"shared-damage-desc",value:d.damageDescription,onChange:s=>b(t=>({...t,damageDescription:s.target.value})),placeholder:"Describe the damage affecting items in this receiving...",className:"min-h-[60px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"shared-notes",className:"text-sm font-medium",children:"Notes (applied to all items)"}),e.jsx(ke,{id:"shared-notes",value:d.globalNotes,onChange:s=>b(t=>({...t,globalNotes:s.target.value})),placeholder:"Optional notes for all items in this receiving batch...",className:"min-h-[60px]"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsx(S,{className:"text-sm font-medium text-slate-700",children:"Receiving Items"}),e.jsxs(w,{type:"button",variant:"outline",size:"sm",onClick:Ce,className:"text-green-600 border-green-200 hover:bg-green-50 self-start sm:self-auto",children:[e.jsx(He,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 2fr 0.5fr",gap:"12px"},children:[e.jsx("div",{className:"bg-slate-50 border-b px-4 py-3 text-sm font-medium text-slate-700",children:"SKU"}),e.jsx("div",{className:"bg-slate-50 border-b px-4 py-3 text-sm font-medium text-slate-700",children:"Quantity"}),e.jsx("div",{className:"bg-slate-50 border-b px-4 py-3 text-sm font-medium text-slate-700",children:"Unit Cost"}),e.jsx("div",{className:"bg-slate-50 border-b px-4 py-3 text-sm font-medium text-slate-700",children:"Notes"}),e.jsx("div",{className:"bg-slate-50 border-b px-4 py-3 text-sm font-medium text-slate-700 text-center",children:"Actions"}),m.map((s,t)=>{const n=Object.keys(f).filter(r=>r.startsWith(`line-${s.id}`)).length>0;return e.jsxs(Se.Fragment,{children:[e.jsx("div",{className:`px-4 py-3 min-h-[60px] ${n?"bg-red-50":""} ${t>0?"border-t":""}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ue,{id:`sku-${s.id}`,skus:c,value:s.skuId,onChange:r=>K(s.id,{skuId:r}),placeholder:"Select SKU",error:f[`line-${s.id}-sku`]}),f[`line-${s.id}-sku`]&&e.jsxs("div",{className:"text-xs text-red-600 flex items-start gap-1 min-h-[16px] leading-tight",children:[e.jsx(H,{className:"h-3 w-3 shrink-0 mt-0.5"}),e.jsx("span",{className:"break-words",children:f[`line-${s.id}-sku`]})]})]})}),e.jsx("div",{className:`px-4 py-3 min-h-[60px] ${n?"bg-red-50":""} ${t>0?"border-t":""}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{id:`qty-${s.id}`,type:"number",step:"any",min:"0",value:s.qty||"",onChange:r=>{const $=Number.isNaN(parseFloat(r.target.value))?0:parseFloat(r.target.value);K(s.id,{qty:Math.max(0,$)})},className:`h-9 flex-1 ${f[`line-${s.id}-qty`]?"border-red-500":""}`,placeholder:"0"}),e.jsx("span",{className:"text-xs text-slate-500 min-w-[24px] text-center",children:s.skuId&&c.find(r=>r.id===s.skuId)?.unit||""})]}),f[`line-${s.id}-qty`]&&e.jsxs("div",{className:"text-xs text-red-600 flex items-start gap-1 min-h-[16px] leading-tight",children:[e.jsx(H,{className:"h-3 w-3 shrink-0 mt-0.5"}),e.jsx("span",{className:"break-words",children:f[`line-${s.id}-qty`]})]})]})}),e.jsx("div",{className:`px-4 py-3 min-h-[60px] ${n?"bg-red-50":""} ${t>0?"border-t":""}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ke,{id:`cost-${s.id}`,value:s.unitCost,onChange:r=>K(s.id,{unitCost:r}),error:f[`line-${s.id}-cost`],placeholder:"$0.00"}),f[`line-${s.id}-cost`]&&e.jsxs("div",{className:"text-xs text-red-600 flex items-start gap-1 min-h-[16px] leading-tight",children:[e.jsx(H,{className:"h-3 w-3 shrink-0 mt-0.5"}),e.jsx("span",{className:"break-words",children:f[`line-${s.id}-cost`]})]})]})}),e.jsx("div",{className:`px-4 py-3 min-h-[60px] ${n?"bg-red-50":""} ${t>0?"border-t":""}`,children:e.jsx("div",{className:"h-9 flex items-center",children:e.jsx(E,{value:s.notes,onChange:r=>K(s.id,{notes:r.target.value}),placeholder:"Optional notes",className:"h-9 w-full"})})}),e.jsx("div",{className:`px-4 py-3 min-h-[60px] ${n?"bg-red-50":""} ${t>0?"border-t":""} flex justify-center items-start pt-6`,children:e.jsx(w,{type:"button",variant:"outline",size:"sm",onClick:()=>$e(s.id),disabled:m.length<=1,className:"text-red-600 border-red-200 hover:bg-red-50 h-9 w-9 p-0",children:e.jsx(Me,{className:"h-4 w-4"})})})]},s.id)})]})})}),e.jsx("div",{className:"bg-slate-50 p-3 rounded-lg text-sm",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-slate-600",children:["Total Items: ",m.filter(s=>s.skuId&&s.qty>0).length]}),e.jsxs("span",{className:"text-slate-600",children:["Total Value: $",m.filter(s=>s.skuId&&s.qty>0).reduce((s,t)=>s+t.qty*t.unitCost,0).toFixed(2)]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsx("div",{className:"text-sm text-slate-500",children:R&&"Processing items..."}),e.jsx("div",{className:"flex gap-2",children:e.jsx(w,{type:"button",variant:"outline",onClick:()=>F(!0),disabled:R||m.filter(s=>s.skuId&&s.qty>0).length===0,className:"bg-blue-600 text-white hover:bg-blue-700",children:R?"Processing...":`Process ${m.filter(s=>s.skuId&&s.qty>0).length} Items`})})]})]})]}),Q&&je.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50",role:"presentation",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30","aria-hidden":"true",onClick:()=>F(!1)}),e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-[min(100%,640px)]",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-batch-title",ref:J,children:e.jsxs(V,{className:"rounded-2xl shadow-2xl bg-white ring-1 ring-black/10",children:[e.jsx(P,{children:e.jsx(T,{id:"confirm-batch-title",children:"Confirm Multi-SKU Receiving"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Date:"})," ",d.date]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Vendor:"})," ",d.vendor||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Packing Slip:"})," ",d.packingSlip||"-"]}),d.isDamaged&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Damage:"})," Yes - ",d.damageDescription||"No description"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-sm",children:["Items to Process (",m.filter(s=>s.skuId&&s.qty>0).length,"):"]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(Ne,{children:[e.jsx(ye,{children:e.jsxs(C,{className:"bg-slate-50",children:[e.jsx(k,{className:"text-xs",children:"SKU"}),e.jsx(k,{className:"text-xs text-right",children:"Qty"}),e.jsx(k,{className:"text-xs text-right",children:"Cost"}),e.jsx(k,{className:"text-xs text-right",children:"Value"})]})}),e.jsxs(be,{children:[m.filter(s=>s.skuId&&s.qty>0).map(s=>e.jsxs(C,{className:"text-xs",children:[e.jsx(g,{children:s.skuId}),e.jsx(g,{className:"text-right",children:s.qty}),e.jsxs(g,{className:"text-right",children:["$",s.unitCost.toFixed(2)]}),e.jsxs(g,{className:"text-right",children:["$",(s.qty*s.unitCost).toFixed(2)]})]},s.id)),e.jsxs(C,{className:"bg-slate-50 font-medium text-xs",children:[e.jsx(g,{children:"Total"}),e.jsx(g,{className:"text-right",children:m.filter(s=>s.skuId&&s.qty>0).reduce((s,t)=>s+t.qty,0)}),e.jsx(g,{}),e.jsxs(g,{className:"text-right",children:["$",m.filter(s=>s.skuId&&s.qty>0).reduce((s,t)=>s+t.qty*t.unitCost,0).toFixed(2)]})]})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(w,{variant:"outline",onClick:()=>F(!1),"data-modal-initial":"true",children:"Cancel"}),e.jsx(w,{onClick:()=>{F(!1),De()},disabled:R,children:R?"Processing...":"Confirm & Process All"})]})]})]})})]}),document.body),Ie&&he.length>0&&je.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50",role:"presentation",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30","aria-hidden":"true",onClick:()=>_(!1)}),e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-[min(100%,640px)]",role:"dialog","aria-modal":"true","aria-labelledby":"batch-results-title",children:e.jsxs(V,{className:"rounded-2xl shadow-2xl bg-white ring-1 ring-black/10",children:[e.jsx(P,{children:e.jsx(T,{id:"batch-results-title",children:"Processing Results"})}),e.jsxs(A,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:he.map((s,t)=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg text-sm ${s.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[e.jsx("span",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs ${s.success?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:s.success?"✓":"✗"}),e.jsxs("span",{className:"flex-1",children:[e.jsx("strong",{children:s.line.skuId})," - ",s.line.qty," units",s.error&&e.jsxs("div",{className:"text-xs mt-1",children:["Error: ",s.error]})]})]},s.line.id))}),e.jsx("div",{className:"flex justify-end gap-2 pt-2",children:e.jsx(w,{onClick:()=>_(!1),children:"Close"})})]})]})})]}),document.body)]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(V,{className:"rounded-xl border border-dashed",children:[e.jsx(P,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(T,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Ve,{className:"h-5 w-5 text-slate-500"}),"Inventory Layers (FIFO)"]}),e.jsx("div",{className:"w-1/2",children:e.jsxs(se,{value:v,onValueChange:y,children:[e.jsx(te,{placeholder:"Select a SKU...",children:e.jsx(ae,{})}),e.jsx(ie,{children:c.map(s=>e.jsxs(re,{value:s.id,children:[s.id," — ",s.description]},s.id))})]})})]})}),e.jsxs(A,{children:[e.jsx(Pe,{className:"h-[300px] pr-4",children:e.jsxs(Ne,{children:[e.jsx(ye,{children:e.jsxs(C,{children:[e.jsx(k,{children:"Layer ID"}),e.jsx(k,{children:"Date"}),e.jsx(k,{children:"Remaining qty"}),e.jsx(k,{children:"Unit cost"}),e.jsx(k,{children:"Asset Value"})]})}),e.jsx(be,{children:W?e.jsx(C,{children:e.jsx(g,{colSpan:5,className:"text-center text-sm text-slate-500",children:"Loading layers..."})}):v?p.filter(s=>s.remaining>0).length===0?e.jsx(C,{children:e.jsx(g,{colSpan:5,className:"text-center text-sm text-slate-500",children:"No active layers found for the selected SKU."})}):(I?p.filter(s=>s.remaining>0):p.filter(s=>s.remaining>0).slice(0,10)).map(s=>e.jsxs(C,{children:[e.jsx(g,{children:s.id}),e.jsx(g,{children:typeof s.date=="string"?s.date:new Date(s.date).toLocaleDateString()}),e.jsx(g,{children:s.remaining}),e.jsx(g,{children:B(s.cost)}),e.jsx(g,{children:B(s.remaining*s.cost)})]},s.id)):e.jsx(C,{children:e.jsx(g,{colSpan:5,className:"text-center text-sm text-slate-500",children:"Select a SKU to view its layers."})})})]})}),p.filter(s=>s.remaining>0).length>10&&e.jsx("div",{className:"mt-2 text-center",children:e.jsx(w,{variant:"link",onClick:()=>Y(!I),children:I?"Show less":`View all ${p.filter(s=>s.remaining>0).length} layers`})})]})]})}),e.jsx("div",{className:"space-y-4",children:e.jsx(ze,{title:"Recent submissions",icon:e.jsx(we,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs("div",{className:"space-y-2",children:[fe.map((s,t)=>e.jsxs("div",{className:"p-3 rounded-xl border border-dashed",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[s.ref," — ",s.skuOrName]}),e.jsx(ve,{variant:"secondary",children:"RECEIVED"})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[new Date(s.datetime).toLocaleDateString()," • ",s.qty," units • ",B(s.value)]})]},`${s.datetime}-${t}`)),fe.length===0&&e.jsx("div",{className:"p-3 rounded-xl border border-dashed",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No recent submissions."})})]})})})]})]})}export{os as default};
