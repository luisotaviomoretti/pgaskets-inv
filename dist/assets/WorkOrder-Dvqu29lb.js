import{r,q as ce,j as e,o as oe,L as O,T as E,i as K,k as p,l as h,m as z,n as i,I as A,B as I,S as me,e as he,f as je,g as fe,h as ee,R as Me,s as Se,C as Oe,b as $e,c as Ae,d as We}from"./index-DZR-c3RH.js";import{L as ue,w as Ue}from"./schemas-C5xDTXWF.js";function B({message:m,id:y}){return e.jsxs("div",{id:y,className:"flex items-center gap-1 text-sm text-red-600 mt-1",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:m})]})}function Fe({skus:m,filter:y,value:C,onChange:se,placeholder:te,id:W,error:U}){const c=y?m.filter(N=>N.type===y):m;return e.jsxs(me,{value:C,onValueChange:se,children:[e.jsx(he,{id:W,className:`h-10 w-full ${U?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!U,"aria-describedby":U?`${W}-error`:void 0,children:e.jsx(je,{placeholder:te})}),e.jsx(fe,{children:c.map(N=>e.jsxs(ee,{value:N.id,children:[N.id," — ",N.description]},N.id))})]})}function xe({className:m}){return e.jsx("svg",{className:m,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}function Qe({className:m}){return e.jsx("svg",{className:m,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}function pe({className:m}){return e.jsx("svg",{className:m,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}function _({title:m,icon:y,children:C}){return e.jsxs(Oe,{className:"rounded-xl border border-dashed",children:[e.jsx($e,{className:"py-4",children:e.jsxs(Ae,{className:"flex items-center gap-2 text-lg",children:[y,m]})}),e.jsx(We,{children:C})]})}function Ee({skus:m,layersBySku:y,onUpdateLayers:C,onUpdateSKU:se,onAddMovement:te,woId:W,onRefreshInventory:U}){const[c,N]=r.useState([{id:"1",skuId:"",qty:0,notes:""}]),[M,G]=r.useState([]),[x,ae]=r.useState("AUTO"),[b,ne]=r.useState(""),[q,Y]=r.useState(0),[P,ie]=r.useState(""),[D,re]=r.useState(""),[v,V]=r.useState(null),[o,ye]=r.useState({}),[J,F]=r.useState(!1),X=r.useRef(""),ge=()=>{const s=new Date,t=d=>d.toString().padStart(2,"0"),a=s.getFullYear(),n=t(s.getMonth()+1),j=t(s.getDate()),l=t(s.getHours()),u=t(s.getMinutes());return`${a}${n}${j}${l}${u}`};if(!X.current){const s=Math.random().toString(36).slice(2,6).toUpperCase();X.current=`WO-${ge()}-${s}`}const Ne=r.useCallback(()=>{const s=[];o.outputName&&s.push("outputName"),x==="MANUAL"&&o.producedQty&&s.push("producedQty"),c.forEach(t=>{o[`raw-sku-${t.id}`]&&s.push(`raw-sku-${t.id}`),o[`raw-qty-${t.id}`]&&s.push(`raw-qty-${t.id}`)});for(const t of s){const a=document.getElementById(t);if(a){a.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>a.focus&&a.focus(),150);break}}},[o,c,x]),ve=r.useCallback(()=>{const s=(Math.max(...c.map(t=>parseInt(t.id)),0)+1).toString();N(t=>[...t,{id:s,skuId:"",qty:0,notes:""}])},[c]),ke=r.useCallback(s=>{c.length>1&&N(t=>t.filter(a=>a.id!==s))},[c.length]),Z=r.useCallback((s,t)=>{N(a=>a.map(n=>n.id===s?{...n,...t}:n))},[]),le=r.useCallback(()=>{const s=new Map;c.filter(t=>t.skuId&&t.qty>0).forEach(t=>{const a=s.get(t.skuId)||0;s.set(t.skuId,a+t.qty)}),G(t=>{const a=[];for(const[n,j]of s.entries()){const l=t.find(u=>u.skuId===n);a.push({skuId:n,wasteQty:l?Math.min(l.wasteQty,j):0,maxWaste:j})}return a})},[c]);r.useEffect(()=>{le()},[le]);const we=r.useCallback((s,t)=>{G(a=>a.map(n=>n.skuId===s?{...n,wasteQty:Math.max(0,Math.min(t,n.maxWaste))}:n))},[]),T=r.useMemo(()=>c.reduce((s,t)=>s+(t.qty||0),0),[c]),R=r.useMemo(()=>M.reduce((s,t)=>s+(t.wasteQty||0),0),[M]),$=r.useMemo(()=>Math.max(0,T-R),[T,R]);r.useEffect(()=>{x==="AUTO"&&Y($)},[x,$]),r.useEffect(()=>{if(!v)return;const s=t=>{t.key==="Escape"&&V(null)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[v]),r.useEffect(()=>{v&&(async()=>{try{const t=(await ce(v)).map(a=>{const n=a.date instanceof Date?a.date:new Date(a.date),j=isNaN(n.getTime())?String(a.date):n.toISOString().split("T")[0];return{id:a.id,date:j,remaining:a.remaining,cost:a.cost}});C&&C(v,t)}catch(s){console.error("Failed to load layers for modal",v,s)}})()},[v,C]),r.useEffect(()=>{if(!J)return;const s=t=>{t.key==="Escape"&&F(!1)};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[J]);const H=r.useMemo(()=>{const s=c.filter(t=>t.skuId&&t.qty>0).map(t=>m.find(a=>a.id===t.skuId)?.unit).filter(Boolean);return s.length===0||s.every(t=>t===s[0])},[c,m]);r.useEffect(()=>{const s={};c.forEach(a=>{const n=`raw-sku-${a.id}`,j=`raw-qty-${a.id}`;if((a.qty||0)>0&&!a.skuId&&(s[n]="SKU is required for this line"),a.skuId&&(a.qty||0)<=0&&(s[j]="Quantity must be greater than 0"),a.skuId&&(a.qty||0)>0){const l=(y[a.skuId]||[]).reduce((u,d)=>u+(d.remaining||0),0);(a.qty||0)>l&&(s[j]="Insufficient stock for this SKU. Receive more in Receiving.")}});const t=new Map;c.filter(a=>a.skuId&&(a.qty||0)>0).forEach(a=>t.set(a.skuId,(t.get(a.skuId)||0)+(a.qty||0)));for(const[a,n]of t.entries()){const j=(y[a]||[]).reduce((l,u)=>l+(u.remaining||0),0);n>j+1e-9&&c.forEach(l=>{l.skuId===a&&(s[`raw-qty-${l.id}`]="Insufficient stock across lines for this SKU.")})}b.trim()||(s.outputName="Finished product name is required"),x==="MANUAL"&&q<=0&&(s.producedQty="Produced quantity must be greater than 0"),ye(s)},[c,b,x,q,y]);const S=r.useMemo(()=>c.filter(s=>s.skuId&&s.qty>0).map(s=>{const t=y[s.skuId]||[],a=[];let n=s.qty;for(const k of t.slice().sort((g,w)=>new Date(g.date).getTime()-new Date(w.date).getTime())){if(n<=0)break;const g=Math.min(n,k.remaining);a.push({layerId:k.id,qty:g,cost:k.cost}),n-=g}const j=a.reduce((k,g)=>k+Math.round(g.cost*100)*g.qty,0),l=j/100,u=a.reduce((k,g)=>k+g.qty,0),d=u>=s.qty;return{skuId:s.skuId,plan:a,totalCost:l,totalCostCents:j,totalQty:u,canFulfill:d}}),[c,y]),be=S.reduce((s,t)=>s+t.totalCostCents,0)/100,Q=r.useMemo(()=>{const s=new Map;return M.forEach(t=>s.set(t.skuId,(s.get(t.skuId)||0)+(t.wasteQty||0))),S.map(t=>{const a=t.totalQty,n=a>0?t.totalCostCents/a/100:0,j=Math.min(s.get(t.skuId)||0,a),l=Math.max(0,a-j);return{skuId:t.skuId,qty:l,unitCost:n,value:t.totalCostCents/100}})},[S,M]),Ie=r.useMemo(()=>Q.reduce((s,t)=>s+t.qty,0),[Q]),Ce=r.useMemo(()=>Q.reduce((s,t)=>s+t.value,0),[Q]),de=r.useMemo(()=>{if(!b.trim()||x==="MANUAL"&&q<=0||x==="AUTO"&&!H||c.filter(n=>n.skuId&&n.qty>0).length===0)return!1;const t=T,a=(x==="AUTO"?$:q)+R;if(Math.abs(t-a)>.01)return!1;for(const n of S)if(!n.canFulfill)return!1;return!0},[b,x,q,H,c,T,R,$,S]),qe=async()=>{if(!b.trim()){alert("Finished product name is required to finalize Work Order");return}if(x==="MANUAL"&&q<=0){alert("Produced quantity must be greater than 0");return}if(x==="AUTO"&&!H){alert("Cannot use AUTO mode with incompatible units across RAW SKUs");return}const s=c.filter(l=>l.skuId&&l.qty>0);if(s.length===0){alert("Add at least one RAW material line with quantity > 0");return}const t=x==="AUTO"?$:q,a=T,n=t+R;if(Math.abs(a-n)>.01){alert(`Consumption (${a}) must equal production + waste (${n})`);return}for(const l of S)if(!l.canFulfill){alert(`Insufficient inventory for SKU ${l.skuId}. Required: ${s.filter(u=>u.skuId===l.skuId).reduce((u,d)=>u+d.qty,0)}, Available: ${l.totalQty}`);return}const j=W&&W.trim()?W.trim():X.current;try{const u=c.filter(f=>f.skuId&&f.qty>0).map(f=>({sku:f.skuId,unit:m.find(L=>L.id===f.skuId)?.unit||"",qty:f.qty})),d=M.map(f=>({sku:f.skuId,unit:m.find(L=>L.id===f.skuId)?.unit||"",qty:f.wasteQty})),g=u.map(f=>f.unit).filter(f=>!!f)[0]||"",w={code:j,datetime:new Date().toISOString(),outputName:b.trim(),outputUnit:g,mode:x,outputQty:t,raw:u,waste:d};Ue.parse(w)}catch(l){const u=l?.errors?.[0]?.message||"Invalid Work Order data. Please review the form.";alert(u);return}try{const l=await Se({outputName:b.trim(),outputQuantity:t,rawMaterials:c.filter(d=>d.skuId&&d.qty>0).map(d=>({skuId:d.skuId,quantity:d.qty})),wasteLines:M.filter(d=>d.wasteQty>0).map(d=>({skuId:d.skuId,quantity:d.wasteQty})),date:new Date,reference:j,notes:JSON.stringify({client:P,invoice:D})});alert(`Work Order ${l.workOrderId} finalized successfully!
${t} units of "${b.trim()}" produced.`);const u=Array.from(new Set(c.filter(d=>d.skuId&&d.qty>0).map(d=>d.skuId)));for(const d of u)try{const g=(await ce(d)).map(w=>{const f=w.date instanceof Date?w.date:new Date(w.date),L=isNaN(f.getTime())?String(w.date):f.toISOString().split("T")[0];return{id:w.id,date:L,remaining:w.remaining,cost:w.cost}});C&&C(d,g)}catch(k){console.error("Failed to refresh layers for",d,k)}U&&U(),N([{id:"1",skuId:"",qty:0,notes:""}]),G([]),ae("AUTO"),ne(""),Y(0),ie(""),re("")}catch(l){const u=l?.message||"Failed to finalize Work Order. Please try again.";alert(u)}};return e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(_,{title:"Work Order — Finalization",icon:e.jsx(xe,{className:"h-5 w-5 text-slate-500"}),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(oe,{children:"WO-00425"}),e.jsx(oe,{variant:"secondary",children:"OPEN"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(O,{className:"text-xs text-slate-500 mb-1.5",children:"1) Raw material consumption (FIFO from oldest layers)"}),e.jsxs("div",{className:"rounded-2xl border border-dashed p-3",children:[e.jsxs(E,{children:[e.jsx(K,{children:e.jsxs(p,{children:[e.jsx(h,{children:"SKU (Raw)"}),e.jsx(h,{children:"Quantity"}),e.jsx(h,{children:"Notes"}),e.jsx(h,{})]})}),e.jsx(z,{children:c.map(s=>e.jsxs(p,{children:[e.jsxs(i,{className:"min-w-[220px]",children:[e.jsx(Fe,{skus:m,filter:"RAW",value:s.skuId,onChange:t=>Z(s.id,{skuId:t}),placeholder:"Select Raw SKU",id:`raw-sku-${s.id}`,error:o[`raw-sku-${s.id}`]}),o[`raw-sku-${s.id}`]&&e.jsx(B,{id:`raw-sku-${s.id}-error`,message:o[`raw-sku-${s.id}`]})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{id:`raw-qty-${s.id}`,type:"number",min:"0",step:"any",value:s.qty||"",onChange:t=>Z(s.id,{qty:Math.max(0,parseFloat(t.target.value||"0"))}),placeholder:"0","aria-invalid":!!o[`raw-qty-${s.id}`],"aria-describedby":o[`raw-qty-${s.id}`]?`raw-qty-${s.id}-error`:void 0,className:`flex-1 h-10 ${o[`raw-qty-${s.id}`]?"border-red-500 focus:ring-red-500":""}`}),e.jsx("span",{className:"text-xs text-slate-500 min-w-[36px] text-right",children:m.find(t=>t.id===s.skuId)?.unit??""})]}),o[`raw-qty-${s.id}`]&&e.jsx(B,{id:`raw-qty-${s.id}-error`,message:o[`raw-qty-${s.id}`]})]}),e.jsx(i,{children:e.jsx(A,{value:s.notes,onChange:t=>Z(s.id,{notes:t.target.value}),placeholder:"e.g., Coil A",className:"h-10"})}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-3 justify-end",children:[e.jsx(I,{variant:"outline",className:"text-green-600 px-0 border-0 hover:bg-transparent",onClick:()=>s.skuId&&V(s.skuId),disabled:!s.skuId,children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ue,{className:"h-4 w-4 text-green-600"}),"See Raw Layers (balance)"]})}),e.jsx(I,{variant:"outline",onClick:()=>ke(s.id),disabled:c.length<=1,children:"Remove"})]})})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 text-xs text-slate-500",children:[e.jsx("div",{children:"Consumption plan (FIFO) below is auto-calculated."}),e.jsx(I,{size:"sm",variant:"outline",onClick:ve,children:"Add line"})]})]})]}),e.jsxs("div",{children:[e.jsx(O,{className:"text-xs text-slate-500 mb-1.5",children:"2) Waste"}),e.jsxs("div",{className:"rounded-2xl border border-dashed p-3 space-y-2",children:[M.length===0?e.jsx("p",{className:"text-xs text-slate-500",children:"Waste lines will appear for each RAW SKU with qty > 0."}):e.jsxs(E,{children:[e.jsx(K,{children:e.jsxs(p,{children:[e.jsx(h,{children:"SKU"}),e.jsx(h,{children:"Waste qty"}),e.jsx(h,{children:"Max"})]})}),e.jsx(z,{children:M.map(s=>e.jsxs(p,{children:[e.jsx(i,{children:s.skuId}),e.jsx(i,{className:"min-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{id:`waste-qty-${s.skuId}`,type:"number",min:"0",step:"any",max:s.maxWaste,value:s.wasteQty||"",onChange:t=>we(s.skuId,Math.max(0,parseFloat(t.target.value||"0"))),placeholder:"0",className:"flex-1 h-10"}),e.jsx("span",{className:"text-xs text-slate-500 min-w-[36px] text-right",children:m.find(t=>t.id===s.skuId)?.unit??""})]})}),e.jsx(i,{className:"text-xs text-slate-500",children:s.maxWaste})]},s.skuId))})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Waste value is calculated via FIFO from the consumed layers per SKU."})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(O,{className:"text-xs text-slate-500 mb-1.5",children:"3) Output"}),e.jsxs("div",{className:"rounded-2xl border border-dashed p-4 grid grid-cols-1 md:grid-cols-12 gap-4",children:[e.jsxs("div",{className:"md:col-span-12 lg:col-span-6",children:[e.jsx(O,{className:"mb-1.5 block",children:"Finished product name *"}),e.jsx(A,{id:"outputName",value:b,onChange:s=>ne(s.target.value),placeholder:"e.g., Gasket Kit 50mm",className:`h-10 w-full ${o.outputName?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!o.outputName,"aria-describedby":o.outputName?"outputName-error":void 0}),o.outputName&&e.jsx(B,{id:"outputName-error",message:o.outputName})]}),e.jsxs("div",{className:"md:col-span-6 lg:col-span-3",children:[e.jsx(O,{className:"mb-1.5 block",children:"Output mode"}),e.jsxs(me,{value:x,onValueChange:s=>ae(s),children:[e.jsx(he,{className:"h-10 w-full",children:e.jsx(je,{placeholder:"Mode"})}),e.jsxs(fe,{children:[e.jsx(ee,{value:"AUTO",children:"AUTO (Σ RAW - Σ Waste)"}),e.jsx(ee,{value:"MANUAL",children:"MANUAL"})]})]}),x==="AUTO"&&!H&&e.jsx("div",{className:"text-xs text-amber-600 mt-1",children:"Units across RAW SKUs differ; AUTO not allowed."})]}),e.jsxs("div",{className:"md:col-span-6 lg:col-span-3",children:[e.jsxs(O,{className:"mb-1.5 block",children:["Produced quantity",x==="MANUAL"?" *":""]}),e.jsx(A,{id:"producedQty",type:"number",value:x==="AUTO"?$:q,onChange:s=>Y(Math.max(0,parseFloat(s.target.value||"0"))),placeholder:"0",className:`h-10 w-full ${o.producedQty?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!o.producedQty,"aria-describedby":o.producedQty?"producedQty-error":void 0,disabled:x==="AUTO"}),x==="MANUAL"&&o.producedQty&&e.jsx(B,{id:"producedQty-error",message:o.producedQty})]}),e.jsxs("div",{className:"md:col-span-12 lg:col-span-6",children:[e.jsx(O,{className:"mb-1.5 block",children:"Client (free text)"}),e.jsx(A,{id:"woClient",value:P,onChange:s=>ie(s.target.value),placeholder:"e.g., ACME Corp",className:"h-10 w-full"})]}),e.jsxs("div",{className:"md:col-span-12 lg:col-span-6",children:[e.jsx(O,{className:"mb-1.5 block",children:"Invoice number (free text)"}),e.jsx(A,{id:"woInvoice",value:D,onChange:s=>re(s.target.value),placeholder:"e.g., INV-2025-0001",className:"h-10 w-full"})]})]})]}),e.jsxs("div",{className:"md:col-span-2 flex items-center gap-2",children:[e.jsx(I,{className:"rounded-xl",onClick:()=>F(!0),disabled:!de,children:"Finalize WO"}),!de&&e.jsx(I,{type:"button",variant:"outline",className:"rounded-xl",onClick:Ne,children:"Fix errors"}),e.jsx(I,{variant:"outline",className:"rounded-xl",children:"Save draft"})]})]})]}),e.jsx(_,{title:"FIFO breakdown (auto)",icon:e.jsx(Qe,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs(E,{children:[e.jsx(K,{children:e.jsxs(p,{children:[e.jsx(h,{children:"SKU"}),e.jsx(h,{children:"Layer"}),e.jsx(h,{children:"Qty"}),e.jsx(h,{children:"Unit cost"}),e.jsx(h,{children:"Value"})]})}),e.jsxs(z,{children:[S.length===0?e.jsx(p,{children:e.jsx(i,{colSpan:5,className:"text-sm text-slate-500",children:"No consumption planned."})}):S.map(s=>e.jsxs(Me.Fragment,{children:[e.jsx(p,{children:e.jsx(i,{colSpan:5,className:"text-sm text-slate-500",children:s.skuId})}),s.plan.map(t=>e.jsxs(p,{children:[e.jsx(i,{}),e.jsx(i,{children:t.layerId}),e.jsx(i,{children:t.qty}),e.jsxs(i,{children:["$ ",t.cost.toFixed(2)]}),e.jsxs(i,{children:["$ ",(t.qty*t.cost).toFixed(2)]})]},t.layerId)),e.jsxs(p,{children:[e.jsx(i,{className:"font-medium",colSpan:2,children:"Total"}),e.jsx(i,{className:"font-medium",children:s.totalQty}),e.jsx(i,{}),e.jsxs(i,{className:"font-medium",children:["$ ",s.totalCost.toFixed(2)]})]})]},s.skuId)),e.jsxs(p,{children:[e.jsx(i,{className:"font-medium",colSpan:4,children:"Grand Total"}),e.jsxs(i,{className:"font-medium",children:["$ ",be.toFixed(2)]})]})]})]})}),e.jsx(_,{title:"Validation notes",icon:e.jsx(pe,{className:"h-5 w-5 text-amber-500"}),children:e.jsxs("ul",{className:"text-sm list-disc pl-5 space-y-1 text-slate-600",children:[e.jsx("li",{children:"No negative balance in Raw or Sellable."}),e.jsx("li",{children:"Total consumption = production + waste (WO consistency)."}),e.jsx("li",{children:"Output name is free text and will appear in Movements once you finalize."}),e.jsxs("li",{children:[e.jsx("b",{children:"Sufficient stock:"})," Raw material must have enough inventory to consume."]}),e.jsxs("li",{children:[e.jsx("b",{children:"Produced > 0:"})," Production quantity must be greater than zero."]}),e.jsxs("li",{children:[e.jsx("b",{children:"Output name required:"})," Output name cannot be empty to finalize WO."]})]})})]}),v&&e.jsxs("div",{className:"fixed inset-0 z-50",onClick:()=>V(null),children:[e.jsx("div",{className:"absolute inset-0 bg-black/40"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"font-medium",children:["Raw Layers (balance) — ",v]})]}),e.jsx(I,{variant:"outline",onClick:()=>V(null),children:"✕"})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("p",{className:"text-xs text-slate-600",children:"Note: quantities will be consumed from the oldest inventory layers first (FIFO)."}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(E,{children:[e.jsx(K,{children:e.jsxs(p,{children:[e.jsx(h,{children:"Layer"}),e.jsx(h,{children:"Date"}),e.jsx(h,{children:"Remaining"}),e.jsx(h,{children:"Cost"})]})}),e.jsxs(z,{children:[(y[v]||[]).slice().sort((s,t)=>new Date(s.date).getTime()-new Date(t.date).getTime()).map(s=>e.jsxs(p,{children:[e.jsx(i,{children:s.id}),e.jsx(i,{children:s.date}),e.jsx(i,{children:s.remaining}),e.jsxs(i,{children:["$ ",s.cost.toFixed(2)]})]},s.id)),(y[v]||[]).length===0&&e.jsx(p,{children:e.jsx(i,{colSpan:4,className:"text-sm text-slate-500",children:"No layers for this SKU."})})]})]})})]})]})})]}),J&&e.jsxs("div",{className:"fixed inset-0 z-50",onClick:()=>F(!1),children:[e.jsx("div",{className:"absolute inset-0 bg-black/40"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-slate-500"}),e.jsx("span",{className:"font-medium",children:"Confirm Work Order"})]}),e.jsx(I,{variant:"outline",onClick:()=>F(!1),children:"✕"})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Please review the consumption summary (FIFO) before finalizing."}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(E,{children:[e.jsx(K,{children:e.jsxs(p,{children:[e.jsx(h,{children:"SKU"}),e.jsx(h,{className:"text-right",children:"Quantity"}),e.jsx(h,{className:"text-right",children:"Unit cost"}),e.jsx(h,{className:"text-right",children:"Value"})]})}),e.jsxs(z,{children:[Q.length===0?e.jsx(p,{children:e.jsx(i,{colSpan:4,className:"text-sm text-slate-500",children:"No items to finalize."})}):Q.map(s=>e.jsxs(p,{children:[e.jsx(i,{children:s.skuId}),e.jsx(i,{className:"text-right",children:s.qty}),e.jsxs(i,{className:"text-right",children:["$ ",s.unitCost.toFixed(2)]}),e.jsxs(i,{className:"text-right",children:["$ ",s.value.toFixed(2)]})]},s.skuId)),e.jsxs(p,{children:[e.jsx(i,{className:"font-medium",children:"Totals"}),e.jsx(i,{className:"font-medium text-right",children:Ie}),e.jsx(i,{}),e.jsxs(i,{className:"font-medium text-right",children:["$ ",Ce.toFixed(2)]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-slate-700",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Output name:"})," ",e.jsx("b",{children:b||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Produced qty:"})," ",e.jsx("b",{children:x==="AUTO"?$:q})]}),P&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Client:"})," ",e.jsx("b",{children:P})]}),D&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Invoice:"})," ",e.jsx("b",{children:D})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx(I,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(I,{onClick:()=>{F(!1),qe()},children:"Confirm & Finalize"})]})]})]})})]})]})}export{Ee as default};
