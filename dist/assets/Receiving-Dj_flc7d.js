import{j as e,R as Be,r as n,p as Ee,C as xe,a as Ke,b as he,c as fe,d as pe,L,I as Q,S as qe,e as Re,f as Oe,g as Fe,h as ge,B as G,T as We,i as _e,k as me,l as re,m as ze,n as se,o as He,t as Je}from"./index-CSJdrheq.js";import{L as Ze,r as Ge}from"./schemas-DC66j4xO.js";const Xe=({id:s,checked:r,onCheckedChange:l,className:u=""})=>e.jsx("input",{id:s,type:"checkbox",className:`h-4 w-4 rounded border-slate-300 text-slate-900 ${u}`,checked:!!r,onChange:v=>l?.(v.target.checked)}),De=Be.forwardRef(function({className:r="",...l},u){return e.jsx("textarea",{ref:u,className:`min-h-[80px] w-full px-3 py-2 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-400 ${r}`,...l})}),X=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),Ye=s=>{if(!s||!s.trim())return 0;const r=s.replace(/[$,\s]/g,"");if(r==="."||r==="")return 0;const l=parseFloat(r);return isNaN(l)?0:Math.max(0,l)},et=(s,r)=>{const l=r.find(u=>u.id===s);return l?l.type==="RAW"?"Raw Material":"Sellable Product":""},tt=s=>!s||s<=0?"Quantity must be at least 1.":null,st=s=>!s||s<=0?"Invalid unit cost.":null,at=s=>!s||s.trim().length<3?"Vendor name must be at least 3 characters.":null,nt=s=>s?null:"Please select a SKU.",rt=(s,r=1e3)=>{const l=s.length,u=r-l,v=l>r;return{count:l,remaining:u,isOverLimit:v}};function it(s){const{vendorName:r,skuId:l,date:u,existingRefs:v=[]}=s;if(!r||!l||!u)return"";const b=r.trim().toUpperCase().replace(/[^A-Z0-9\s-]/g,"").split(/\s+/).filter(Boolean).map(y=>y[0]).join("").slice(0,3)||"VEN",f=l.trim().toUpperCase().replace(/[^A-Z0-9-]/g,"").slice(0,12),j=u.replace(/-/g,""),k=`PS-${b}-${f}-${j}`,d=(v.filter(y=>y?.startsWith(k)).length||0)+1,R=String(d).padStart(3,"0");return`${k}-${R}`}function lt(s){return typeof s=="string"?s&&(s.length<=6?"***":`${s.slice(0,6)}***`):s}function $e(s){if(!s)return;const r={};for(const[l,u]of Object.entries(s))/vendor|invoice|ref|notes|name|bank|address/i.test(l)?r[l]=lt(u):r[l]=u;return r}const Ie={captureEvent(s,r){console.info("[telemetry:event]",s,$e(r))},captureError(s,r,l){console.error("[telemetry:error]",s,$e(l),ct(r))}};function ct(s){if(s instanceof Error)return{message:s.message,stack:s.stack};if(typeof s=="string")return{message:s};try{return{message:JSON.stringify(s)}}catch{return{message:"Unknown error"}}}const ae={event:(s,r)=>Ie.captureEvent(s,r),error:(s,r,l)=>Ie.captureError(s,r,l)};function ot({value:s,onChange:r,suggestions:l,error:u,id:v}){const[b,f]=n.useState(s||""),[j,k]=n.useState(!1),[d,R]=n.useState([]),[y,T]=n.useState(-1),N=n.useRef(null),P=n.useRef(null),o=`${v}-listbox`;n.useEffect(()=>{f(s||"")},[s]),n.useEffect(()=>{const c=setTimeout(()=>{if(b.trim().length>=3){const m=b.trim().toLowerCase(),C=l.filter(F=>F.name.toLowerCase().includes(m)).slice(0,8);R(C),k(!0),T(C.length>0?0:-1)}else R([]),k(!1),T(-1);r(b)},300);return()=>clearTimeout(c)},[b,l,r]);const V=()=>{setTimeout(()=>k(!1),150)},p=n.useMemo(()=>{const c=d[0]?.name||"";return c.toLowerCase().startsWith((b||"").toLowerCase())?c.slice(b.length):""},[d,b]),B=n.useCallback(c=>{f(c.target.value)},[]),g=n.useCallback(()=>{d.length>0&&k(!0)},[d.length]),K=n.useCallback(c=>{if(!j&&(c.key==="ArrowDown"||c.key==="ArrowUp")&&k(!0),c.key==="ArrowDown")c.preventDefault(),T(m=>{const C=d.length;return C===0?-1:m<0?0:(m+1)%C});else if(c.key==="ArrowUp")c.preventDefault(),T(m=>{const C=d.length;return C===0?-1:m<=0?C-1:m-1});else if(c.key==="Enter"){if(j){if(c.preventDefault(),y>=0&&d[y]){const m=d[y];f(m.name),k(!1),r(m.name)}else if(d.length===1){const m=d[0];f(m.name),k(!1),r(m.name)}}}else c.key==="Escape"&&j&&(c.preventDefault(),k(!1))},[j,d,y,r]),O=n.useCallback(c=>{const m=Number.parseInt(c.currentTarget.dataset.index||"-1",10);Number.isNaN(m)||T(m)},[]),U=n.useCallback(c=>{c.preventDefault()},[]),w=n.useCallback(c=>{const m=Number.parseInt(c.currentTarget.dataset.index||"-1",10);if(m>=0&&d[m]){const C=d[m];f(C.name),k(!1),r(C.name),N.current?.focus()}},[d,r]);return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 flex items-center px-3 text-slate-400/60",children:[e.jsx("span",{className:"invisible",children:b}),e.jsx("span",{children:p})]}),e.jsx(Q,{id:v,ref:N,value:b,onChange:B,onBlur:V,onFocus:g,onKeyDown:K,placeholder:"Type vendor name (≥3 chars)...",className:`w-full ${u?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!u,"aria-describedby":u?`${v}-error`:void 0,role:"combobox","aria-autocomplete":"list","aria-controls":o,"aria-expanded":j,"aria-activedescendant":y>=0?`${v}-option-${y}`:void 0}),j&&e.jsx("div",{id:o,role:"listbox","aria-label":"Vendor suggestions",ref:P,className:"absolute z-50 left-0 right-0 mt-1 rounded-xl border bg-white shadow-lg overflow-auto max-h-64",children:d.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-slate-500","aria-live":"polite",children:"No results"}):d.map((c,m)=>e.jsxs("button",{id:`${v}-option-${m}`,role:"option","aria-selected":m===y,type:"button",className:`w-full text-left px-3 py-2 focus:outline-none ${m===y?"bg-slate-100":"hover:bg-slate-50"}`,"data-index":m,onMouseEnter:O,onMouseDown:U,onClick:w,children:[e.jsx("div",{className:"text-sm font-medium",children:c.name}),(c.address||c.bank)&&e.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[c.address??"",c.address&&c.bank?" • ":"",c.bank??""]})]},c.name))})]})}function dt({skus:s,value:r,onChange:l,placeholder:u,error:v,id:b}){return e.jsxs(qe,{value:r,onValueChange:l,children:[e.jsx(Re,{id:b,className:`h-10 w-full ${v?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!v,"aria-describedby":v?`${b}-error`:void 0,children:e.jsx(Oe,{placeholder:u})}),e.jsx(Fe,{children:s.map(f=>e.jsxs(ge,{value:f.id,children:[f.id," — ",f.description]},f.id))})]})}function ut({className:s}){return e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}function ie({message:s,id:r}){return e.jsxs("div",{id:r,className:"flex items-center gap-1 text-sm text-red-600 mt-1",children:[e.jsx(ut,{className:"h-4 w-4"}),e.jsx("span",{children:s})]})}function mt({value:s,onChange:r,error:l,id:u,placeholder:v="$0.00"}){const[b,f]=n.useState(""),[j,k]=n.useState(!1);n.useEffect(()=>{!j&&s>0?f(X(s)):!j&&s===0&&f("")},[s,j]);const d=T=>{const N=T.target.value;f(N);const P=Ye(N);r(P)},R=()=>{k(!0),s>0&&f(s.toString())},y=()=>{k(!1),s>0?f(X(s)):f("")};return e.jsx(Q,{id:u,type:"text",value:b,onChange:d,onFocus:R,onBlur:y,placeholder:v,className:`h-10 ${l?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!l,"aria-describedby":l?`${u}-error`:void 0})}function Le({className:s}){return e.jsx("svg",{className:s,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}function Te({title:s,icon:r,children:l}){return e.jsxs(xe,{className:"rounded-xl border border-dashed",children:[e.jsx(he,{className:"py-4",children:e.jsxs(fe,{className:"flex items-center gap-2 text-lg",children:[r,s]})}),e.jsx(pe,{children:l})]})}function vt({vendors:s,skus:r,layersBySku:l,movements:u,onUpdateLayers:v,onUpdateSKU:b,onAddMovement:f}){const[j,k]=n.useState([{id:"1",skuId:"",qty:0,unitCost:0,notes:""}]),[d,R]=n.useState({date:new Date().toISOString().split("T")[0],vendor:"",packingSlip:"",isDamaged:!1,damageDescription:"",globalNotes:""}),[y,T]=n.useState(()=>new Date().toISOString().split("T")[0]),[N,P]=n.useState(""),[o,V]=n.useState(""),[p,B]=n.useState(0),[g,K]=n.useState(0),[O,U]=n.useState(""),[w,c]=n.useState(!1),[m,C]=n.useState(""),[F,Y]=n.useState(""),[ve,Ae]=n.useState(!1),[ne,A]=n.useState(!1),le=n.useRef(null),[ce,je]=n.useState([]),E=(t,a="info")=>{const i=`${Date.now()}-${Math.random().toString(36).slice(2,7)}`;je(x=>[...x,{id:i,message:t,kind:a}]),window.setTimeout(()=>{je(x=>x.filter(h=>h.id!==i))},4e3)};n.useCallback(()=>{const t=`${Date.now()}-${Math.random().toString(36).slice(2,7)}`;k(a=>[...a,{id:t,skuId:"",qty:0,unitCost:0,notes:""}])},[]),n.useCallback(t=>{j.length>1&&k(a=>a.filter(i=>i.id!==t))},[j.length]),n.useCallback((t,a)=>{k(i=>i.map(x=>x.id===t?{...x,...a}:x))},[]),n.useCallback((t,a)=>{R(i=>({...i,[t]:a}))},[]);const[xt,ye]=n.useState(!1),[ht,Ne]=n.useState([]),[ft,Pe]=n.useState(!1),be=n.useCallback(()=>{const t={};d.vendor.trim()||(t.vendor="Vendor is required"),d.date||(t.date="Date is required"),j.forEach((i,x)=>{i.skuId||(t[`line-${i.id}-sku`]="SKU is required"),i.qty<=0&&(t[`line-${i.id}-qty`]="Quantity must be greater than 0"),i.unitCost<=0&&(t[`line-${i.id}-cost`]="Unit cost must be greater than 0")});const a=j.reduce((i,x)=>(x.skuId&&(i[x.skuId]=(i[x.skuId]||0)+1),i),{});return Object.entries(a).forEach(([i,x])=>{x>1&&j.forEach(h=>{h.skuId===i&&(t[`line-${h.id}-duplicate`]="Duplicate SKU detected")})}),t},[j,d]);n.useCallback(async()=>{const t=be();if(Object.keys(t).length>0){E("Please fix validation errors before processing","error");return}ye(!0),Ne([]);const a=[];try{for(const h of j)try{await Ee({skuId:h.skuId,quantity:h.qty,unitCost:h.unitCost,date:new Date(d.date),vendorName:d.vendor,packingSlipNo:d.packingSlip||void 0,notes:`${d.globalNotes} ${h.notes}`.trim()||void 0}),a.push({line:h,success:!0}),E(`✓ ${h.skuId} received successfully`,"success")}catch(_){a.push({line:h,success:!1,error:_.message||"Processing failed"}),E(`✗ ${h.skuId} failed: ${_.message}`,"error")}Ne(a),Pe(!0);const i=a.filter(h=>h.success).length,x=a.length;i===x?(E(`All ${x} items processed successfully!`,"success"),k([{id:"1",skuId:"",qty:0,unitCost:0,notes:""}]),R(h=>({...h,globalNotes:"",packingSlip:""}))):E(`${i}/${x} items processed successfully`,"info")}finally{ye(!1)}},[j,d,be,E,v,b]),n.useEffect(()=>{if(!ne)return;const t=le.current,a=t?.querySelector('[data-modal-initial="true"]'),i=t?.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');(a||i)?.focus();const x=h=>{if(ne){if(h.key==="Escape"){h.preventDefault(),A(!1);return}if(h.key==="Tab"){const _=le.current;if(!_)return;const $=Array.from(_.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(ue=>!ue.hasAttribute("disabled"));if(!$.length)return;const I=document.activeElement;let D=I?$.indexOf(I):-1;h.preventDefault(),h.shiftKey?D=(D-1+$.length)%$.length:D=(D+1)%$.length,$[D]?.focus()}}};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[ne]);const[q,z]=n.useState("NONE"),[H,W]=n.useState(0),[S,ee]=n.useState({}),M=r.find(t=>t.id===o);n.useEffect(()=>{const t={},a=at(N);a&&(t.vendor=a);const i=nt(o);i&&(t.sku=i);const x=tt(p);x&&(t.quantity=x);const h=st(g);h&&(t.unitCost=h),ee(t)},[N,o,p,g]),n.useEffect(()=>{W(t=>{const a=Math.max(0,p||0);return Math.max(0,Math.min(t||0,a))})},[p]),n.useEffect(()=>{if(ve)return;const t=(u||[]).map(i=>i.ref).filter(Boolean),a=it({vendorName:N,skuId:o,date:y,existingRefs:t});a&&O!==a&&U(a)},[N,o,y,u,ve]);const ke=n.useMemo(()=>rt(F),[F]),oe=n.useMemo(()=>Object.keys(S).length===0&&N.trim().length>=3&&o&&p>0&&g>0,[S,N,o,p,g]),Se=n.useMemo(()=>u?u.filter(t=>t.type==="RECEIVE").sort((t,a)=>new Date(a.datetime).getTime()-new Date(t.datetime).getTime()).slice(0,3):[],[u]),de=()=>{const t=["date","vendor","sku","quantity","unitCost"];for(const a of t)if(S[a]){document.getElementById(a)?.focus();break}},J=n.useMemo(()=>{const t=Math.max(0,p||0);if(!w||q==="NONE")return{acceptQty:t,wasteQty:0};if(q==="FULL")return{acceptQty:0,wasteQty:t};const a=Math.max(0,Math.min(H||0,t));return{acceptQty:Math.max(0,t-a),wasteQty:a}},[w,q,p,H]),[we,Ce]=n.useState(!1),Ue=async()=>{if(!oe){de();return}const t=O||`PS-${Date.now()}`,{acceptQty:a,wasteQty:i}=J;if(ae.event("receiving_submit_attempt",{sku:o,qty:a,unitCost:g,vendor:N,isDamaged:w,damageScope:q,ref:t}),w&&q==="FULL"){f?.({datetime:new Date().toISOString().replace("T"," ").substring(0,16),type:"WASTE",skuOrName:o,qty:-i,value:-(i*g),ref:`${t}-FULL-REJECT`}),E(`Packing slip fully rejected. ${i} units registered as waste.`,"info"),V(""),B(0),K(0),U(""),c(!1),z("NONE"),W(0),Y(""),A(!1);return}if(a<=0){E("No quantity to accept (all rejected)","error"),A(!1);return}let x;try{const $=Je(N),I=M?.unit||"";x={vendorId:$,invoice:t,datetime:new Date(`${y}T00:00:00Z`).toISOString(),lines:[{sku:o,unit:I,qty:a,unitCost:g}],notes:F?.trim()||void 0,isDamaged:w,damageScope:q,rejectedQty:w?H:void 0},Ge.parse(x)}catch($){const I=$?.issues,D={};if(I&&Array.isArray(I))for(const Z of I){const te=Z.path.join(".");te.startsWith("lines.0.qty")?D.quantity=Z.message:te.startsWith("lines.0.unitCost")?D.unitCost=Z.message:te.startsWith("lines.0.sku")?D.sku=Z.message:te==="vendorId"?D.vendor=Z.message:te==="datetime"&&(D.date=Z.message)}Object.keys(D).length>0&&ee(D);const ue=I?.[0]?.message||"Invalid receiving data. Please review the form.";E(ue,"error"),de(),A(!1);return}const _={id:`${o}-L${Date.now()}`,date:new Date().toISOString().split("T")[0],remaining:a,cost:g};try{Ce(!0),await Ee({skuId:o,quantity:a,unitCost:g,date:new Date(y),vendorName:N,packingSlipNo:t,notes:F?.trim()||void 0});const I=[...l[o]||[],_];v?.(o,I);const D=M?.onHand||0;b?.(o,{onHand:D+a}),f?.({datetime:new Date().toISOString().replace("T"," ").substring(0,16),type:"RECEIVE",skuOrName:o,qty:a,value:a*g,ref:t}),w&&q==="PARTIAL"&&i>0&&f?.({datetime:new Date().toISOString().replace("T"," ").substring(0,16),type:"WASTE",skuOrName:o,qty:-i,value:-(i*g),ref:`${t}-REJECTED`}),E(`Successfully approved! ${a} units added to inventory.`,"success"),ae.event("receiving_submit_success",{sku:o,acceptQty:a,wasteQty:i,unitCost:g,ref:t}),T(new Date().toISOString().split("T")[0]),P(""),V(""),B(0),K(0),U(""),c(!1),C(""),z("NONE"),W(0),Y(""),ee({}),A(!1)}catch($){const I=$?.message||"Failed to submit receiving. Please try again.";E(I,"error"),ae.error("receiving_submit_failed",$,{sku:o,acceptQty:a,unitCost:g,ref:t}),A(!1);return}finally{Ce(!1)}},Me=()=>{if(!oe){de();return}A(!0)},Qe=()=>{if(!o||p<=0){E("Please fill in SKU and quantity first","error");return}ae.event("receiving_full_reject",{sku:o,qty:p,unitCost:g,ref:`${O||`PS-${Date.now()}`}-FULL-REJECT`}),f?.({datetime:new Date().toISOString().replace("T"," ").substring(0,16),type:"WASTE",skuOrName:o,qty:-p,value:-(p*(g||0)),ref:`${O||`PS-${Date.now()}`}-FULL-REJECT`}),E(`Entire packing slip rejected! ${p} units marked as waste.`,"info"),T(new Date().toISOString().split("T")[0]),P(""),V(""),B(0),K(0),U(""),c(!1),z("NONE"),W(0),Y(""),ee({})},Ve=()=>{if(!o||p<=0){E("Please fill in SKU and quantity first","error");return}if(!N.trim()){E("Please select a vendor first","error");return}const t=O||`PS-${Date.now()}`;ae.event("receiving_return_to_vendor",{sku:o,qty:p,unitCost:g,vendor:N,ref:t}),f?.({datetime:new Date().toISOString().replace("T"," ").substring(0,16),type:"WASTE",skuOrName:o,qty:-p,value:-(p*(g||0)),ref:`${t}-RETURN-TO-VENDOR`}),E(`${p} units of ${o} returned to vendor: ${N}`,"info"),T(new Date().toISOString().split("T")[0]),P(""),V(""),B(0),K(0),U(""),c(!1),C(""),z("NONE"),W(0),Y(""),ee({})};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"sr-only","aria-live":"polite",children:ce.slice(-1).map(t=>e.jsx("span",{children:t.message},t.id))}),ce.length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-[60] space-y-2",children:ce.map(t=>e.jsx("div",{role:"status",className:`rounded-lg shadow-lg px-3 py-2 text-sm ring-1 ${t.kind==="error"?"bg-red-600 text-white ring-red-700":t.kind==="success"?"bg-emerald-600 text-white ring-emerald-700":"bg-slate-800 text-white ring-slate-900"}`,children:t.message},t.id))}),e.jsxs(xe,{className:"max-w-3xl mx-auto",children:[e.jsx(he,{children:e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5 text-slate-500"}),"Receiving Form"]})}),e.jsx(pe,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 md:gap-6",children:[e.jsxs("div",{className:"col-span-12 md:col-span-3 space-y-2",children:[e.jsx(L,{htmlFor:"date",className:"text-sm font-medium",children:"Date"}),e.jsx(Q,{id:"date",type:"date",value:y,onChange:t=>T(t.target.value),className:"h-10",placeholder:"mm/dd/yyyy"})]}),e.jsxs("div",{className:"col-span-12 md:col-span-9 space-y-2",children:[e.jsx(L,{htmlFor:"vendor",className:"text-sm font-medium",children:"Vendor *"}),e.jsx(ot,{id:"vendor",value:N,onChange:P,suggestions:s,error:S.vendor}),S.vendor&&e.jsx(ie,{message:S.vendor,id:"vendor-error"})]}),e.jsxs("div",{className:"col-span-12 md:col-span-6 space-y-2 mt-6",children:[e.jsx(L,{htmlFor:"sku",className:"text-sm font-medium",children:"SKU *"}),e.jsx(dt,{id:"sku",skus:r,value:o,onChange:V,placeholder:"Select SKU",error:S.sku}),S.sku&&e.jsx(ie,{message:S.sku,id:"sku-error"})]}),e.jsxs("div",{className:"col-span-12 md:col-span-6 space-y-2 mt-6",children:[e.jsx(L,{htmlFor:"type",className:"text-sm font-medium",children:"Type"}),e.jsx(Q,{id:"type",value:M?et(M.id,r):"",className:"h-10 bg-slate-50",placeholder:"Automatically set from SKU",readOnly:!0,"aria-disabled":"true",title:"Auto from SKU"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Automatically set from SKU"})]}),e.jsxs("div",{className:"col-span-12 md:col-span-4 space-y-2 mt-6",children:[e.jsxs(L,{htmlFor:"quantity",className:"text-sm font-medium",children:["Quantity",M?.unit?` (${M.unit})`:""," *"]}),e.jsx(Q,{id:"quantity",type:"number",step:"any",min:"0",value:p||"",onChange:t=>{const a=Number.isNaN(parseFloat(t.target.value))?0:parseFloat(t.target.value);B(Math.max(0,a))},className:`h-10 ${S.quantity?"border-red-500 focus:ring-red-500":""}`,placeholder:"0","aria-invalid":!!S.quantity,"aria-describedby":S.quantity?"quantity-error":void 0}),S.quantity&&e.jsx(ie,{message:S.quantity,id:"quantity-error"})]}),e.jsxs("div",{className:"col-span-12 md:col-span-4 space-y-2 mt-6",children:[e.jsx(L,{htmlFor:"unitCost",className:"text-sm font-medium",children:"Unit cost *"}),e.jsx(mt,{id:"unitCost",value:g,onChange:K,error:S.unitCost,placeholder:"$0.00"}),S.unitCost&&e.jsx(ie,{message:S.unitCost,id:"unitCost-error"})]}),e.jsx("div",{className:"col-span-12 md:col-span-4 mt-6"})," ",e.jsxs("div",{className:"col-span-12 md:col-span-8 space-y-2 mt-6",children:[e.jsx(L,{htmlFor:"packingSlip",className:"text-sm font-medium",children:"Packing slip (No.)"}),e.jsx(Q,{id:"packingSlip",value:O,onChange:t=>{U(t.target.value),Ae(!!t.target.value)},className:"h-10",placeholder:"PS-2025-0001"})]}),e.jsx("div",{className:"col-span-12 md:col-span-4 flex items-end pb-2 mt-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Xe,{id:"damaged",checked:w,onCheckedChange:t=>{const a=!!t;c(a),z(a?"FULL":"NONE"),a||(W(0),C(""))}}),e.jsx(L,{htmlFor:"damaged",className:"text-sm font-medium cursor-pointer",children:"Damaged?"})]})}),w&&e.jsxs("div",{className:"col-span-12 space-y-2 mt-6",children:[e.jsx(L,{htmlFor:"damageDescription",className:"text-sm font-medium",children:"Damage description"}),e.jsx(De,{id:"damageDescription",value:m,onChange:t=>C(t.target.value),placeholder:"Describe the damage...",className:"min-h-[80px]"})]}),w&&e.jsxs("div",{className:"col-span-12 grid grid-cols-1 md:grid-cols-3 gap-3 mt-6",children:[e.jsxs("div",{children:[e.jsx(L,{className:"text-sm font-medium",children:"Damage scope"}),e.jsxs(qe,{value:q,onValueChange:t=>z(t),children:[e.jsx(Re,{className:"h-10 w-full",children:e.jsx(Oe,{placeholder:"Select"})}),e.jsxs(Fe,{children:[e.jsx(ge,{value:"FULL",children:"Entire packing slip"}),e.jsx(ge,{value:"PARTIAL",children:"Partial"})]})]})]}),q==="PARTIAL"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs(L,{className:"text-sm font-medium",children:["Rejected qty",M?.unit?` (${M.unit})`:""]}),e.jsx(Q,{type:"number",step:"any",min:0,max:p,value:H,onChange:t=>{const a=Number.isNaN(parseFloat(t.target.value))?0:parseFloat(t.target.value);W(Math.max(0,Math.min(a,p)))},className:"h-10"})]}),e.jsxs("div",{children:[e.jsx(L,{className:"text-sm font-medium",children:"Accepted qty"}),e.jsx(Q,{value:Math.max(0,J.acceptQty),readOnly:!0,className:"h-10 bg-slate-50"})]})]})]}),w&&e.jsx("div",{className:"col-span-12 mt-4",children:e.jsx("p",{className:"text-xs text-amber-700 bg-amber-50 p-2 rounded",children:q==="FULL"?"The entire packing slip will be rejected (no inventory entry).":"Partial damage: the rejected quantity will not enter inventory."})}),e.jsxs("div",{className:"col-span-12 space-y-2 mt-6",children:[e.jsx(L,{htmlFor:"notes",className:"text-sm font-medium",children:"Notes"}),e.jsx(De,{id:"notes",value:F,onChange:t=>Y(t.target.value),placeholder:"Inspection notes",className:"min-h-[120px]",maxLength:1e3}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500",children:[e.jsx("span",{children:"Optional"}),e.jsxs("span",{className:ke.isOverLimit?"text-red-500":"",children:[ke.count,"/1000 characters"]})]})]})]})}),ne&&Ke.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50",role:"presentation",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30","aria-hidden":"true",onClick:()=>A(!1)}),e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-[min(100%,560px)]",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-receiving-title",ref:le,children:e.jsxs(xe,{className:"rounded-2xl shadow-2xl bg-white ring-1 ring-black/10",children:[e.jsx(he,{children:e.jsx(fe,{id:"confirm-receiving-title",children:"Confirm receiving"})}),e.jsxs(pe,{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Date:"})," ",y]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Vendor:"})," ",N||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Packing Slip:"})," ",O||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"SKU:"})," ",o||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Accepted qty:"})," ",Math.max(0,J.acceptQty)]}),w&&J.wasteQty>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Rejected qty:"})," ",J.wasteQty]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Unit cost:"})," ",X(g||0)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Total value:"})," ",X(Math.max(0,J.acceptQty)*(g||0))]})]}),F?.trim()&&e.jsxs("div",{className:"text-xs text-slate-700",children:["Notes: ",F.trim()]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(G,{variant:"outline",onClick:()=>A(!1),"data-modal-initial":"true",children:"Cancel"}),e.jsx(G,{onClick:Ue,disabled:we,children:we?"Submitting…":"Confirm & submit"})]})]})]})})]}),document.body),e.jsx("div",{className:"sticky bottom-0 bg-white border-t p-4",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(G,{variant:"outline",type:"button",children:"Cancel"}),w&&q==="FULL"?e.jsxs(e.Fragment,{children:[e.jsx(G,{variant:"destructive",onClick:Qe,children:"Reject entire packing slip"}),e.jsx(G,{variant:"outline",onClick:Ve,disabled:!N.trim()||p<=0,children:"Return to vendor"})]}):e.jsx(G,{onClick:Me,disabled:!oe,className:"min-w-[200px]",children:w&&q==="PARTIAL"?`Approve partial (${Math.max(0,p-H)} in, ${H} out)`:"Approve & add to inventory"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Te,{title:"Recent RAW layers (FIFO)",icon:e.jsx(Ze,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs(We,{children:[e.jsx(_e,{children:e.jsxs(me,{children:[e.jsx(re,{children:"Layer ID"}),e.jsx(re,{children:"Date"}),e.jsx(re,{children:"Remaining qty"}),e.jsx(re,{children:"Unit cost"})]})}),e.jsxs(ze,{children:[(l[o]||[]).slice(0,3).map(t=>e.jsxs(me,{children:[e.jsx(se,{children:t.id}),e.jsx(se,{children:typeof t.date=="string"?t.date:new Date(t.date).toLocaleDateString()}),e.jsx(se,{children:t.remaining}),e.jsx(se,{children:X(t.cost)})]},t.id)),(!o||(l[o]||[]).length===0)&&e.jsx(me,{children:e.jsx(se,{colSpan:4,className:"text-sm text-slate-500",children:"Select a SKU to view its recent layers."})})]})]})})}),e.jsx("div",{className:"space-y-4",children:e.jsx(Te,{title:"Recent submissions",icon:e.jsx(Le,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs("div",{className:"space-y-2",children:[Se.map((t,a)=>e.jsxs("div",{className:"p-3 rounded-xl border border-dashed",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[t.ref," — ",t.skuOrName]}),e.jsx(He,{variant:"secondary",children:"RECEIVED"})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[new Date(t.datetime).toLocaleDateString()," • ",t.qty," units • ",X(t.value)]})]},`${t.datetime}-${a}`)),Se.length===0&&e.jsx("div",{className:"p-3 rounded-xl border border-dashed",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No recent submissions."})})]})})})]})]})}export{vt as default};
