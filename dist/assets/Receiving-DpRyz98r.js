import{R as Re,j as e,r as t,p as Ee,C as H,a as ve,b as Y,c as Z,d as G,L as I,I as M,B as Ne,e as L,T as ae,f as ie,g as q,h as y,i as ne,k as v,S as Le,l as Me,m as Fe,n as Te,o as Pe}from"./index-BKRk5lZ_.js";import{M as Ae,L as Oe}from"./schemas-BMOVbwG-.js";const be=Re.forwardRef(function({className:o="",...x},g){return e.jsx("textarea",{ref:g,className:`min-h-[80px] w-full px-3 py-2 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-400 ${o}`,...x})}),J=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(r),Ve=r=>{if(!r||!r.trim())return 0;const o=r.replace(/[$,\s]/g,"");if(o==="."||o==="")return 0;const x=parseFloat(o);return isNaN(x)?0:Math.max(0,x)},Be=(r,o=1e3)=>{const x=r.length,g=o-x,j=x>o;return{count:x,remaining:g,isOverLimit:j}};function Ue(r){const{vendorName:o,date:x,existingRefs:g=[]}=r;if(!o||!x)return"";const j=o.trim().toUpperCase().replace(/[^A-Z0-9\s-]/g,"").split(/\s+/).filter(Boolean).map(a=>a[0]).join("").slice(0,3)||"VEN",f=x.replace(/-/g,""),h=`PS-${j}-BATCH-${f}`,l=(g.filter(a=>a?.startsWith(h)).length||0)+1,p=String(l).padStart(3,"0");return`${h}-${p}`}function Qe({value:r,onChange:o,suggestions:x,error:g,id:j}){const[f,h]=t.useState(r||""),[l,p]=t.useState(!1),[a,b]=t.useState([]),[S,C]=t.useState(-1),$=t.useRef(null),O=t.useRef(null),w=`${j}-listbox`;t.useEffect(()=>{h(r||"")},[r]),t.useEffect(()=>{const c=setTimeout(()=>{if(f.trim().length>=3){const u=f.trim().toLowerCase(),k=x.filter(U=>U.name.toLowerCase().includes(u)).slice(0,8);b(k),p(!0),C(k.length>0?0:-1)}else b([]),p(!1),C(-1);o(f)},300);return()=>clearTimeout(c)},[f,x,o]);const re=()=>{setTimeout(()=>p(!1),150)},D=t.useMemo(()=>{const c=a[0]?.name||"";return c.toLowerCase().startsWith((f||"").toLowerCase())?c.slice(f.length):""},[a,f]),le=t.useCallback(c=>{h(c.target.value)},[]),V=t.useCallback(()=>{a.length>0&&p(!0)},[a.length]),ce=t.useCallback(c=>{if(!l&&(c.key==="ArrowDown"||c.key==="ArrowUp")&&p(!0),c.key==="ArrowDown")c.preventDefault(),C(u=>{const k=a.length;return k===0?-1:u<0?0:(u+1)%k});else if(c.key==="ArrowUp")c.preventDefault(),C(u=>{const k=a.length;return k===0?-1:u<=0?k-1:u-1});else if(c.key==="Enter"){if(l){if(c.preventDefault(),S>=0&&a[S]){const u=a[S];h(u.name),p(!1),o(u.name)}else if(a.length===1){const u=a[0];h(u.name),p(!1),o(u.name)}}}else c.key==="Escape"&&l&&(c.preventDefault(),p(!1))},[l,a,S,o]),de=t.useCallback(c=>{const u=Number.parseInt(c.currentTarget.dataset.index||"-1",10);Number.isNaN(u)||C(u)},[]),oe=t.useCallback(c=>{c.preventDefault()},[]),B=t.useCallback(c=>{const u=Number.parseInt(c.currentTarget.dataset.index||"-1",10);if(u>=0&&a[u]){const k=a[u];h(k.name),p(!1),o(k.name),$.current?.focus()}},[a,o]);return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 flex items-center px-3 text-slate-400/60",children:[e.jsx("span",{className:"invisible",children:f}),e.jsx("span",{children:D})]}),e.jsx(M,{id:j,ref:$,value:f,onChange:le,onBlur:re,onFocus:V,onKeyDown:ce,placeholder:"Type vendor name (≥3 chars)...",className:`w-full ${g?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!g,"aria-describedby":g?`${j}-error`:void 0,role:"combobox","aria-autocomplete":"list","aria-controls":w,"aria-expanded":l,"aria-activedescendant":S>=0?`${j}-option-${S}`:void 0}),l&&e.jsx("div",{id:w,role:"listbox","aria-label":"Vendor suggestions",ref:O,className:"absolute z-50 left-0 right-0 mt-1 rounded-xl border bg-white shadow-lg overflow-auto max-h-64",children:a.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-slate-500","aria-live":"polite",children:"No results"}):a.map((c,u)=>e.jsxs("button",{id:`${j}-option-${u}`,role:"option","aria-selected":u===S,type:"button",className:`w-full text-left px-3 py-2 focus:outline-none ${u===S?"bg-slate-100":"hover:bg-slate-50"}`,"data-index":u,onMouseEnter:de,onMouseDown:oe,onClick:B,children:[e.jsx("div",{className:"text-sm font-medium",children:c.name}),(c.address||c.bank)&&e.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[c.address??"",c.address&&c.bank?" • ":"",c.bank??""]})]},c.name))})]})}function Ke({skus:r,value:o,onChange:x,placeholder:g,error:j,id:f}){return e.jsxs(Le,{value:o,onValueChange:x,children:[e.jsx(Me,{id:f,className:`h-10 w-full ${j?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!j,"aria-describedby":j?`${f}-error`:void 0,children:e.jsx(Fe,{placeholder:g})}),e.jsx(Te,{children:r.map(h=>e.jsxs(Pe,{value:h.id,children:[h.id," — ",h.description]},h.id))})]})}function ze({className:r}){return e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}function W({message:r,id:o}){return e.jsxs("div",{id:o,className:"flex items-center gap-1 text-sm text-red-600 mt-1",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{children:r})]})}function We({value:r,onChange:o,error:x,id:g,placeholder:j="$0.00"}){const[f,h]=t.useState(""),[l,p]=t.useState(!1);t.useEffect(()=>{!l&&r>0?h(J(r)):!l&&r===0&&h("")},[r,l]);const a=C=>{const $=C.target.value;h($);const O=Ve($);o(O)},b=()=>{p(!0),r>0&&h(r.toString())},S=()=>{p(!1),r>0?h(J(r)):h("")};return e.jsx(M,{id:g,type:"text",value:f,onChange:a,onFocus:b,onBlur:S,placeholder:j,className:`h-10 ${x?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!x,"aria-describedby":x?`${g}-error`:void 0})}function ye({className:r}){return e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}function ke({title:r,icon:o,children:x}){return e.jsxs(H,{className:"rounded-xl border border-dashed",children:[e.jsx(Y,{className:"py-4",children:e.jsxs(Z,{className:"flex items-center gap-2 text-lg",children:[o,r]})}),e.jsx(G,{children:x})]})}function He({className:r}){return e.jsx("svg",{className:r,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}function es({vendors:r,skus:o,layersBySku:x,movements:g,onUpdateLayers:j,onUpdateSKU:f,onAddMovement:h}){const[l,p]=t.useState([{id:"1",skuId:"",qty:0,unitCost:0,notes:""}]),[a,b]=t.useState({date:new Date().toISOString().split("T")[0],vendor:"",packingSlip:"",isDamaged:!1,damageDescription:"",globalNotes:""}),[S,C]=t.useState(()=>new Date().toISOString().split("T")[0]),[$,O]=t.useState(""),[w,re]=t.useState(""),[D,le]=t.useState(0),[V,ce]=t.useState(0),[de,oe]=t.useState(""),[B,c]=t.useState(!1),[u,k]=t.useState(""),[U,Ye]=t.useState(""),[X,ue]=t.useState(!1),[Q,F]=t.useState(!1),_=t.useRef(null),[ee,xe]=t.useState([]),R=(s,i="info")=>{const d=`${Date.now()}-${Math.random().toString(36).slice(2,7)}`;xe(n=>[...n,{id:d,message:s,kind:i}]),window.setTimeout(()=>{xe(n=>n.filter(m=>m.id!==d))},4e3)},Se=t.useCallback(()=>{const s=`${Date.now()}-${Math.random().toString(36).slice(2,7)}`;p(i=>[...i,{id:s,skuId:"",qty:0,unitCost:0,notes:""}])},[]),we=t.useCallback(s=>{l.length>1&&p(i=>i.filter(d=>d.id!==s))},[l.length]),K=t.useCallback((s,i)=>{p(d=>d.map(n=>n.id===s?{...n,...i}:n))},[]);t.useCallback((s,i)=>{b(d=>({...d,[s]:i}))},[]);const[T,me]=t.useState(!1),[he,ge]=t.useState([]),[Ce,se]=t.useState(!1),z=t.useCallback(()=>{const s={};a.vendor.trim()||(s.vendor="Vendor is required"),a.date||(s.date="Date is required"),l.forEach((d,n)=>{d.skuId||(s[`line-${d.id}-sku`]="SKU is required"),d.qty<=0&&(s[`line-${d.id}-qty`]="Quantity must be greater than 0"),d.unitCost<=0&&(s[`line-${d.id}-cost`]="Unit cost must be greater than 0")});const i=l.reduce((d,n)=>(n.skuId&&(d[n.skuId]=(d[n.skuId]||0)+1),d),{});return Object.entries(i).forEach(([d,n])=>{n>1&&l.forEach(m=>{m.skuId===d&&(s[`line-${m.id}-duplicate`]="Duplicate SKU detected")})}),s},[l,a]),$e=t.useCallback(async()=>{const s=z();if(Object.keys(s).length>0){R("Please fix validation errors before processing","error");return}me(!0),ge([]);const i=[];try{for(const m of l)try{await Ee({skuId:m.skuId,quantity:m.qty,unitCost:m.unitCost,date:new Date(a.date),vendorName:a.vendor,packingSlipNo:a.packingSlip||void 0,notes:`${a.globalNotes} ${m.notes}`.trim()||void 0}),i.push({line:m,success:!0}),R(`✓ ${m.skuId} received successfully`,"success")}catch(P){i.push({line:m,success:!1,error:P.message||"Processing failed"}),R(`✗ ${m.skuId} failed: ${P.message}`,"error")}ge(i),se(!0);const d=i.filter(m=>m.success).length,n=i.length;d===n?(R(`All ${n} items processed successfully!`,"success"),p([{id:"1",skuId:"",qty:0,unitCost:0,notes:""}]),b(m=>({...m,globalNotes:"",packingSlip:""}))):R(`${d}/${n} items processed successfully`,"info")}finally{me(!1)}},[l,a,z,R,j,f]);t.useEffect(()=>{if(!Q)return;const s=_.current,i=s?.querySelector('[data-modal-initial="true"]'),d=s?.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');(i||d)?.focus();const n=m=>{if(Q){if(m.key==="Escape"){m.preventDefault(),F(!1);return}if(m.key==="Tab"){const P=_.current;if(!P)return;const E=Array.from(P.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(qe=>!qe.hasAttribute("disabled"));if(!E.length)return;const je=document.activeElement;let A=je?E.indexOf(je):-1;m.preventDefault(),m.shiftKey?A=(A-1+E.length)%E.length:A=(A+1)%E.length,E[A]?.focus()}}};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[Q]);const[te,Ze]=t.useState("NONE"),[fe,De]=t.useState(0),[N,Ie]=t.useState({});o.find(s=>s.id===w),t.useEffect(()=>{const s=z();Ie(s)},[z]),t.useEffect(()=>{De(s=>{const i=Math.max(0,D||0);return Math.max(0,Math.min(s||0,i))})},[D]),t.useEffect(()=>{if(X||!a.vendor.trim()||!a.date||!l.some(n=>n.skuId&&n.qty>0))return;const i=(g||[]).map(n=>n.ref).filter(Boolean),d=Ue({vendorName:a.vendor,date:a.date,existingRefs:i});d&&d!==a.packingSlip&&b(n=>({...n,packingSlip:d}))},[a.vendor,a.date,l,g,X]),t.useMemo(()=>Be(U),[U]),t.useMemo(()=>Object.keys(N).length===0&&$.trim().length>=3&&w&&D>0&&V>0,[N,$,w,D,V]);const pe=t.useMemo(()=>g?g.filter(s=>s.type==="RECEIVE").sort((s,i)=>new Date(i.datetime).getTime()-new Date(s.datetime).getTime()).slice(0,3):[],[g]);t.useMemo(()=>{const s=Math.max(0,D||0);if(!B||te==="NONE")return{acceptQty:s,wasteQty:0};if(te==="FULL")return{acceptQty:0,wasteQty:s};const i=Math.max(0,Math.min(fe||0,s));return{acceptQty:Math.max(0,s-i),wasteQty:i}},[B,te,D,fe]);const[Ge,Je]=t.useState(!1);return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"sr-only","aria-live":"polite",children:ee.slice(-1).map(s=>e.jsx("span",{children:s.message},s.id))}),ee.length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-[60] space-y-2",children:ee.map(s=>e.jsx("div",{role:"status",className:`rounded-lg shadow-lg px-3 py-2 text-sm ring-1 ${s.kind==="error"?"bg-red-600 text-white ring-red-700":s.kind==="success"?"bg-emerald-600 text-white ring-emerald-700":"bg-slate-800 text-white ring-slate-900"}`,children:s.message},s.id))}),e.jsxs(H,{className:"max-w-7xl mx-auto",children:[e.jsx(Y,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-slate-500"}),"Multi-SKU Receiving Form"]})}),e.jsxs(G,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-slate-50 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"shared-date",className:"text-sm font-medium",children:"Date"}),e.jsx(M,{id:"shared-date",type:"date",value:a.date,onChange:s=>b(i=>({...i,date:s.target.value})),className:"h-10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"shared-vendor",className:"text-sm font-medium",children:"Vendor *"}),e.jsx(Qe,{id:"shared-vendor",value:a.vendor,onChange:s=>b(i=>({...i,vendor:s})),suggestions:r,error:N.vendor}),N.vendor&&e.jsx(W,{message:N.vendor,id:"shared-vendor-error"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"shared-packing-slip",className:"text-sm font-medium",children:"Packing Slip"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{id:"shared-packing-slip",value:a.packingSlip,onChange:s=>{b(i=>({...i,packingSlip:s.target.value})),ue(!0)},onFocus:()=>{a.packingSlip||ue(!1)},className:"h-10 flex-1",placeholder:"Auto-generated or enter manually"}),!X&&a.packingSlip&&e.jsx(Ne,{variant:"secondary",className:"text-xs px-2 py-1",children:"Auto"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{className:"text-sm font-medium",children:"Damage Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"shared-damaged",type:"checkbox",checked:a.isDamaged,onChange:s=>b(i=>({...i,isDamaged:s.target.checked})),className:"rounded"}),e.jsx(I,{htmlFor:"shared-damaged",className:"text-sm",children:"Items damaged"})]})]})]}),a.isDamaged&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"shared-damage-desc",className:"text-sm font-medium",children:"Damage Description"}),e.jsx(be,{id:"shared-damage-desc",value:a.damageDescription,onChange:s=>b(i=>({...i,damageDescription:s.target.value})),placeholder:"Describe the damage affecting items in this receiving...",className:"min-h-[60px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"shared-notes",className:"text-sm font-medium",children:"Notes (applied to all items)"}),e.jsx(be,{id:"shared-notes",value:a.globalNotes,onChange:s=>b(i=>({...i,globalNotes:s.target.value})),placeholder:"Optional notes for all items in this receiving batch...",className:"min-h-[60px]"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{className:"text-sm font-medium",children:"Receiving Items"}),e.jsxs(L,{type:"button",variant:"outline",size:"sm",onClick:Se,className:"text-green-600 border-green-200 hover:bg-green-50",children:[e.jsx(He,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(ae,{children:[e.jsx(ie,{children:e.jsxs(q,{className:"bg-slate-50",children:[e.jsx(y,{className:"w-[200px]",children:"SKU"}),e.jsx(y,{className:"w-[120px]",children:"Quantity"}),e.jsx(y,{className:"w-[120px]",children:"Unit Cost"}),e.jsx(y,{className:"w-[200px]",children:"Notes"}),e.jsx(y,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(ne,{children:l.map((s,i)=>{const d=Object.keys(N).filter(n=>n.startsWith(`line-${s.id}`));return e.jsxs(q,{className:d.length>0?"bg-red-50":"",children:[e.jsx(v,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ke,{id:`sku-${s.id}`,skus:o,value:s.skuId,onChange:n=>K(s.id,{skuId:n}),placeholder:"Select SKU",error:N[`line-${s.id}-sku`]}),N[`line-${s.id}-sku`]&&e.jsx(W,{message:N[`line-${s.id}-sku`],id:`sku-${s.id}-error`})]})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{id:`qty-${s.id}`,type:"number",step:"any",min:"0",value:s.qty||"",onChange:n=>{const m=Number.isNaN(parseFloat(n.target.value))?0:parseFloat(n.target.value);K(s.id,{qty:Math.max(0,m)})},className:`h-9 ${N[`line-${s.id}-qty`]?"border-red-500":""}`,placeholder:"0"}),e.jsx("span",{className:"text-xs text-slate-500 min-w-[40px]",children:s.skuId&&o.find(n=>n.id===s.skuId)?.unit||""})]}),N[`line-${s.id}-qty`]&&e.jsx(W,{message:N[`line-${s.id}-qty`],id:`qty-${s.id}-error`})]})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(We,{id:`cost-${s.id}`,value:s.unitCost,onChange:n=>K(s.id,{unitCost:n}),error:N[`line-${s.id}-cost`],placeholder:"$0.00",className:"h-9"}),N[`line-${s.id}-cost`]&&e.jsx(W,{message:N[`line-${s.id}-cost`],id:`cost-${s.id}-error`})]})}),e.jsx(v,{children:e.jsx(M,{value:s.notes,onChange:n=>K(s.id,{notes:n.target.value}),placeholder:"Item-specific notes",className:"h-9"})}),e.jsx(v,{children:e.jsx(L,{type:"button",variant:"outline",size:"sm",onClick:()=>we(s.id),disabled:l.length<=1,className:"text-red-600 border-red-200 hover:bg-red-50",children:e.jsx(Ae,{className:"h-4 w-4"})})})]},s.id)})})]})}),e.jsx("div",{className:"bg-slate-50 p-3 rounded-lg text-sm",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-slate-600",children:["Total Items: ",l.filter(s=>s.skuId&&s.qty>0).length]}),e.jsxs("span",{className:"text-slate-600",children:["Total Value: $",l.filter(s=>s.skuId&&s.qty>0).reduce((s,i)=>s+i.qty*i.unitCost,0).toFixed(2)]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsx("div",{className:"text-sm text-slate-500",children:T&&"Processing items..."}),e.jsx("div",{className:"flex gap-2",children:e.jsx(L,{type:"button",variant:"outline",onClick:()=>F(!0),disabled:T||l.filter(s=>s.skuId&&s.qty>0).length===0,className:"bg-blue-600 text-white hover:bg-blue-700",children:T?"Processing...":`Process ${l.filter(s=>s.skuId&&s.qty>0).length} Items`})})]})]})]}),Q&&ve.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50",role:"presentation",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30","aria-hidden":"true",onClick:()=>F(!1)}),e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-[min(100%,640px)]",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-batch-title",ref:_,children:e.jsxs(H,{className:"rounded-2xl shadow-2xl bg-white ring-1 ring-black/10",children:[e.jsx(Y,{children:e.jsx(Z,{id:"confirm-batch-title",children:"Confirm Multi-SKU Receiving"})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Date:"})," ",a.date]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Vendor:"})," ",a.vendor||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Packing Slip:"})," ",a.packingSlip||"-"]}),a.isDamaged&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Damage:"})," Yes - ",a.damageDescription||"No description"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-sm",children:["Items to Process (",l.filter(s=>s.skuId&&s.qty>0).length,"):"]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(ae,{children:[e.jsx(ie,{children:e.jsxs(q,{className:"bg-slate-50",children:[e.jsx(y,{className:"text-xs",children:"SKU"}),e.jsx(y,{className:"text-xs text-right",children:"Qty"}),e.jsx(y,{className:"text-xs text-right",children:"Cost"}),e.jsx(y,{className:"text-xs text-right",children:"Value"})]})}),e.jsxs(ne,{children:[l.filter(s=>s.skuId&&s.qty>0).map(s=>e.jsxs(q,{className:"text-xs",children:[e.jsx(v,{children:s.skuId}),e.jsx(v,{className:"text-right",children:s.qty}),e.jsxs(v,{className:"text-right",children:["$",s.unitCost.toFixed(2)]}),e.jsxs(v,{className:"text-right",children:["$",(s.qty*s.unitCost).toFixed(2)]})]},s.id)),e.jsxs(q,{className:"bg-slate-50 font-medium text-xs",children:[e.jsx(v,{children:"Total"}),e.jsx(v,{className:"text-right",children:l.filter(s=>s.skuId&&s.qty>0).reduce((s,i)=>s+i.qty,0)}),e.jsx(v,{}),e.jsxs(v,{className:"text-right",children:["$",l.filter(s=>s.skuId&&s.qty>0).reduce((s,i)=>s+i.qty*i.unitCost,0).toFixed(2)]})]})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(L,{variant:"outline",onClick:()=>F(!1),"data-modal-initial":"true",children:"Cancel"}),e.jsx(L,{onClick:()=>{F(!1),$e()},disabled:T,children:T?"Processing...":"Confirm & Process All"})]})]})]})})]}),document.body),Ce&&he.length>0&&ve.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50",role:"presentation",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30","aria-hidden":"true",onClick:()=>se(!1)}),e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-[min(100%,640px)]",role:"dialog","aria-modal":"true","aria-labelledby":"batch-results-title",children:e.jsxs(H,{className:"rounded-2xl shadow-2xl bg-white ring-1 ring-black/10",children:[e.jsx(Y,{children:e.jsx(Z,{id:"batch-results-title",children:"Processing Results"})}),e.jsxs(G,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:he.map((s,i)=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg text-sm ${s.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[e.jsx("span",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs ${s.success?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:s.success?"✓":"✗"}),e.jsxs("span",{className:"flex-1",children:[e.jsx("strong",{children:s.line.skuId})," - ",s.line.qty," units",s.error&&e.jsxs("div",{className:"text-xs mt-1",children:["Error: ",s.error]})]})]},s.line.id))}),e.jsx("div",{className:"flex justify-end gap-2 pt-2",children:e.jsx(L,{onClick:()=>se(!1),children:"Close"})})]})]})})]}),document.body)]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(ke,{title:"Recent RAW layers (FIFO)",icon:e.jsx(Oe,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs(ae,{children:[e.jsx(ie,{children:e.jsxs(q,{children:[e.jsx(y,{children:"Layer ID"}),e.jsx(y,{children:"Date"}),e.jsx(y,{children:"Remaining qty"}),e.jsx(y,{children:"Unit cost"})]})}),e.jsxs(ne,{children:[(x[w]||[]).slice(0,3).map(s=>e.jsxs(q,{children:[e.jsx(v,{children:s.id}),e.jsx(v,{children:typeof s.date=="string"?s.date:new Date(s.date).toLocaleDateString()}),e.jsx(v,{children:s.remaining}),e.jsx(v,{children:J(s.cost)})]},s.id)),(!w||(x[w]||[]).length===0)&&e.jsx(q,{children:e.jsx(v,{colSpan:4,className:"text-sm text-slate-500",children:"Select a SKU to view its recent layers."})})]})]})})}),e.jsx("div",{className:"space-y-4",children:e.jsx(ke,{title:"Recent submissions",icon:e.jsx(ye,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs("div",{className:"space-y-2",children:[pe.map((s,i)=>e.jsxs("div",{className:"p-3 rounded-xl border border-dashed",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[s.ref," — ",s.skuOrName]}),e.jsx(Ne,{variant:"secondary",children:"RECEIVED"})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[new Date(s.datetime).toLocaleDateString()," • ",s.qty," units • ",J(s.value)]})]},`${s.datetime}-${i}`)),pe.length===0&&e.jsx("div",{className:"p-3 rounded-xl border border-dashed",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No recent submissions."})})]})})})]})]})}export{es as default};
