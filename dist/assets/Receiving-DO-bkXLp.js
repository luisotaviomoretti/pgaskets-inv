import{R as fe,j as e,r as a,p as De,C as T,a as ce,b as V,c as A,d as B,L as N,I as D,B as de,e as y,T as oe,f as xe,g as I,h as b,i as me,k as j,S as pe,l as je,m as ve,n as Ne,o as be}from"./index-fhd9Pdmk.js";import{M as qe,L as Ee}from"./schemas-CwySq8EL.js";const ue=fe.forwardRef(function({className:o="",...x},m){return e.jsx("textarea",{ref:m,className:`min-h-[80px] w-full px-3 py-2 rounded-xl border border-slate-300 focus:outline-none focus:ring-2 focus:ring-slate-400 ${o}`,...x})}),U=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(i),Re=i=>{if(!i||!i.trim())return 0;const o=i.replace(/[$,\s]/g,"");if(o==="."||o==="")return 0;const x=parseFloat(o);return isNaN(x)?0:Math.max(0,x)},Fe=(i,o=1e3)=>{const x=i.length,m=o-x,g=x>o;return{count:x,remaining:m,isOverLimit:g}};function Le(i){const{vendorName:o,date:x,existingRefs:m=[]}=i;if(!o||!x)return"";const g=o.trim().toUpperCase().replace(/[^A-Z0-9\s-]/g,"").split(/\s+/).filter(Boolean).map(r=>r[0]).join("").slice(0,3)||"VEN",v=x.replace(/-/g,""),h=`PS-${g}-BATCH-${v}`,d=(m.filter(r=>r?.startsWith(h)).length||0)+1,p=String(d).padStart(3,"0");return`${h}-${p}`}function Me({value:i,onChange:o,suggestions:x,error:m,id:g}){const[v,h]=a.useState(!1),[d,p]=a.useState(""),r=x.some(u=>u.name===i);return a.useEffect(()=>{!r&&i&&(h(!0),p(i))},[i,r]),v?e.jsxs("div",{className:"flex items-center gap-1 h-10 w-full max-w-full min-w-0",children:[e.jsx(D,{id:g,value:d,onChange:u=>{p(u.target.value),o(u.target.value)},placeholder:"Enter vendor...",className:`flex-1 h-full min-w-0 ${m?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!m,"aria-describedby":m?`${g}-error`:void 0}),e.jsx(y,{type:"button",variant:"outline",size:"sm",onClick:()=>{h(!1),p(""),o("")},className:"px-1 h-full text-xs shrink-0 min-w-0 w-6",title:"Select from list",children:"↓"})]}):e.jsxs("div",{className:"flex items-center gap-1 h-10 w-full max-w-full min-w-0",children:[e.jsxs(pe,{value:i,onValueChange:o,children:[e.jsx(je,{id:g,className:`flex-1 h-full min-w-0 ${m?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!m,"aria-describedby":m?`${g}-error`:void 0,children:e.jsx(ve,{placeholder:"Select vendor..."})}),e.jsx(Ne,{className:"max-h-64",children:x.map(u=>e.jsx(be,{value:u.name,children:e.jsx("span",{className:"font-medium",children:u.name})},u.name))})]}),e.jsx(y,{type:"button",variant:"outline",size:"sm",onClick:()=>{h(!0),p(i)},className:"px-1 h-full text-xs shrink-0 min-w-0 w-6",title:"Enter custom vendor",children:"+"})]})}function Pe({skus:i,value:o,onChange:x,placeholder:m,error:g,id:v}){return e.jsxs(pe,{value:o,onValueChange:x,children:[e.jsx(je,{id:v,className:`h-10 w-full ${g?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!g,"aria-describedby":g?`${v}-error`:void 0,children:e.jsx(ve,{placeholder:m})}),e.jsx(Ne,{children:i.map(h=>e.jsxs(be,{value:h.id,children:[h.id," — ",h.description]},h.id))})]})}function O({className:i}){return e.jsx("svg",{className:i,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}function Te({message:i,id:o}){return e.jsxs("div",{id:o,className:"flex items-center gap-1 text-sm text-red-600 mt-1",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{children:i})]})}function Ve({value:i,onChange:o,error:x,id:m,placeholder:g="$0.00"}){const[v,h]=a.useState(""),[d,p]=a.useState(!1);a.useEffect(()=>{!d&&i>0?h(U(i)):!d&&i===0&&h("")},[i,d]);const r=Z=>{const q=Z.target.value;h(q);const G=Re(q);o(G)},u=()=>{p(!0),i>0&&h(i.toString())},Y=()=>{p(!1),i>0?h(U(i)):h("")};return e.jsx(D,{id:m,type:"text",value:v,onChange:r,onFocus:u,onBlur:Y,placeholder:g,className:`h-9 w-full ${x?"border-red-500 focus:ring-red-500":""}`,"aria-invalid":!!x,"aria-describedby":x?`${m}-error`:void 0})}function he({className:i}){return e.jsx("svg",{className:i,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}function ge({title:i,icon:o,children:x}){return e.jsxs(T,{className:"rounded-xl border border-dashed",children:[e.jsx(V,{className:"py-4",children:e.jsxs(A,{className:"flex items-center gap-2 text-lg",children:[o,i]})}),e.jsx(B,{children:x})]})}function Ae({className:i}){return e.jsx("svg",{className:i,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}function es({vendors:i,skus:o,layersBySku:x,movements:m,onUpdateLayers:g,onUpdateSKU:v,onAddMovement:h}){const[d,p]=a.useState([{id:"1",skuId:"",qty:0,unitCost:0,notes:""}]),[r,u]=a.useState({date:new Date().toISOString().split("T")[0],vendor:"",packingSlip:"",isDamaged:!1,damageDescription:"",globalNotes:""}),[Y,Z]=a.useState(()=>new Date().toISOString().split("T")[0]),[q,G]=a.useState(""),[w,Be]=a.useState(""),[S,Oe]=a.useState(0),[J,Ue]=a.useState(0),[Qe,Ke]=a.useState(""),[X,ze]=a.useState(!1),[We,He]=a.useState(""),[_,Ye]=a.useState(""),[Q,ee]=a.useState(!1),[L,E]=a.useState(!1),K=a.useRef(null),[z,se]=a.useState([]),C=(s,t="info")=>{const c=`${Date.now()}-${Math.random().toString(36).slice(2,7)}`;se(l=>[...l,{id:c,message:s,kind:t}]),window.setTimeout(()=>{se(l=>l.filter(n=>n.id!==c))},4e3)},ye=a.useCallback(()=>{const s=`${Date.now()}-${Math.random().toString(36).slice(2,7)}`;p(t=>[...t,{id:s,skuId:"",qty:0,unitCost:0,notes:""}])},[]),ke=a.useCallback(s=>{d.length>1&&p(t=>t.filter(c=>c.id!==s))},[d.length]),M=a.useCallback((s,t)=>{p(c=>c.map(l=>l.id===s?{...l,...t}:l))},[]);a.useCallback((s,t)=>{u(c=>({...c,[s]:t}))},[]);const[R,te]=a.useState(!1),[ae,ie]=a.useState([]),[we,W]=a.useState(!1),P=a.useCallback(()=>{const s={};r.vendor.trim()||(s.vendor="Vendor is required"),r.date||(s.date="Date is required"),d.forEach((c,l)=>{c.skuId||(s[`line-${c.id}-sku`]="SKU is required"),c.qty<=0&&(s[`line-${c.id}-qty`]="Quantity must be greater than 0"),c.unitCost<=0&&(s[`line-${c.id}-cost`]="Unit cost must be greater than 0")});const t=d.reduce((c,l)=>(l.skuId&&(c[l.skuId]=(c[l.skuId]||0)+1),c),{});return Object.entries(t).forEach(([c,l])=>{l>1&&d.forEach(n=>{n.skuId===c&&(s[`line-${n.id}-duplicate`]="Duplicate SKU detected")})}),s},[d,r]),Se=a.useCallback(async()=>{const s=P();if(Object.keys(s).length>0){C("Please fix validation errors before processing","error");return}te(!0),ie([]);const t=[];try{for(const n of d)try{await De({skuId:n.skuId,quantity:n.qty,unitCost:n.unitCost,date:new Date(r.date),vendorName:r.vendor,packingSlipNo:r.packingSlip||void 0,notes:`${r.globalNotes} ${n.notes}`.trim()||void 0}),t.push({line:n,success:!0}),C(`✓ ${n.skuId} received successfully`,"success")}catch(k){t.push({line:n,success:!1,error:k.message||"Processing failed"}),C(`✗ ${n.skuId} failed: ${k.message}`,"error")}ie(t),W(!0);const c=t.filter(n=>n.success).length,l=t.length;c===l?(C(`All ${l} items processed successfully!`,"success"),p([{id:"1",skuId:"",qty:0,unitCost:0,notes:""}]),u(n=>({...n,globalNotes:"",packingSlip:""}))):C(`${c}/${l} items processed successfully`,"info")}finally{te(!1)}},[d,r,P,C,g,v]);a.useEffect(()=>{if(!L)return;const s=K.current,t=s?.querySelector('[data-modal-initial="true"]'),c=s?.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');(t||c)?.focus();const l=n=>{if(L){if(n.key==="Escape"){n.preventDefault(),E(!1);return}if(n.key==="Tab"){const k=K.current;if(!k)return;const $=Array.from(k.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')).filter(Ie=>!Ie.hasAttribute("disabled"));if(!$.length)return;const le=document.activeElement;let F=le?$.indexOf(le):-1;n.preventDefault(),n.shiftKey?F=(F-1+$.length)%$.length:F=(F+1)%$.length,$[F]?.focus()}}};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[L]);const[H,Ze]=a.useState("NONE"),[re,Ce]=a.useState(0),[f,$e]=a.useState({});o.find(s=>s.id===w),a.useEffect(()=>{const s=P();$e(s)},[P]),a.useEffect(()=>{Ce(s=>{const t=Math.max(0,S||0);return Math.max(0,Math.min(s||0,t))})},[S]),a.useEffect(()=>{if(Q||!r.vendor.trim()||!r.date||!d.some(l=>l.skuId&&l.qty>0))return;const t=(m||[]).map(l=>l.ref).filter(Boolean),c=Le({vendorName:r.vendor,date:r.date,existingRefs:t});c&&c!==r.packingSlip&&u(l=>({...l,packingSlip:c}))},[r.vendor,r.date,d,m,Q]),a.useMemo(()=>Fe(_),[_]),a.useMemo(()=>Object.keys(f).length===0&&q.trim().length>=3&&w&&S>0&&J>0,[f,q,w,S,J]);const ne=a.useMemo(()=>m?m.filter(s=>s.type==="RECEIVE").sort((s,t)=>new Date(t.datetime).getTime()-new Date(s.datetime).getTime()).slice(0,3):[],[m]);a.useMemo(()=>{const s=Math.max(0,S||0);if(!X||H==="NONE")return{acceptQty:s,wasteQty:0};if(H==="FULL")return{acceptQty:0,wasteQty:s};const t=Math.max(0,Math.min(re||0,s));return{acceptQty:Math.max(0,s-t),wasteQty:t}},[X,H,S,re]);const[Ge,Je]=a.useState(!1);return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"sr-only","aria-live":"polite",children:z.slice(-1).map(s=>e.jsx("span",{children:s.message},s.id))}),z.length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-[60] space-y-2",children:z.map(s=>e.jsx("div",{role:"status",className:`rounded-lg shadow-lg px-3 py-2 text-sm ring-1 ${s.kind==="error"?"bg-red-600 text-white ring-red-700":s.kind==="success"?"bg-emerald-600 text-white ring-emerald-700":"bg-slate-800 text-white ring-slate-900"}`,children:s.message},s.id))}),e.jsxs(T,{className:"max-w-7xl mx-auto",children:[e.jsx(V,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-slate-500"}),"Multi-SKU Receiving Form"]})}),e.jsxs(B,{className:"p-6 space-y-6",children:[e.jsx("div",{className:"w-full p-4 bg-slate-50 rounded-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3 w-full",children:[e.jsxs("div",{className:"flex flex-col space-y-2 lg:w-[22%] min-w-0",children:[e.jsx(N,{htmlFor:"shared-date",className:"text-sm font-medium text-slate-700",children:"Date"}),e.jsx(D,{id:"shared-date",type:"date",value:r.date,onChange:s=>u(t=>({...t,date:s.target.value})),className:"h-10 w-full"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 lg:w-[40%] min-w-0 max-w-[40%]",children:[e.jsx(N,{htmlFor:"shared-vendor",className:"text-sm font-medium text-slate-700",children:"Vendor *"}),e.jsx("div",{className:"h-10 w-full min-w-0 overflow-hidden",children:e.jsx(Me,{id:"shared-vendor",value:r.vendor,onChange:s=>u(t=>({...t,vendor:s})),suggestions:i,error:f.vendor})}),f.vendor&&e.jsx(Te,{message:f.vendor,id:"shared-vendor-error"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 lg:w-[20%] min-w-0",children:[e.jsx(N,{htmlFor:"shared-packing-slip",className:"text-sm font-medium text-slate-700",children:"Packing Slip"}),e.jsxs("div",{className:"relative h-10 w-full",children:[e.jsx(D,{id:"shared-packing-slip",value:r.packingSlip,onChange:s=>{u(t=>({...t,packingSlip:s.target.value})),ee(!0)},onFocus:()=>{r.packingSlip||ee(!1)},className:"h-10 w-full pr-12",placeholder:"Auto-generated or manual"}),!Q&&r.packingSlip&&e.jsx("div",{className:"absolute right-1 top-1/2 -translate-y-1/2",children:e.jsx(de,{variant:"secondary",className:"text-xs px-1 py-0.5",children:"Auto"})})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 lg:w-[18%] min-w-0",children:[e.jsx(N,{className:"text-sm font-medium text-slate-700",children:"Damage Status"}),e.jsxs("div",{className:"flex items-center h-10 px-3 border rounded-md bg-white w-full",children:[e.jsx("input",{id:"shared-damaged",type:"checkbox",checked:r.isDamaged,onChange:s=>u(t=>({...t,isDamaged:s.target.checked})),className:"rounded mr-2"}),e.jsx(N,{htmlFor:"shared-damaged",className:"text-sm cursor-pointer truncate",children:"Items damaged"})]})]})]})}),r.isDamaged&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"shared-damage-desc",className:"text-sm font-medium",children:"Damage Description"}),e.jsx(ue,{id:"shared-damage-desc",value:r.damageDescription,onChange:s=>u(t=>({...t,damageDescription:s.target.value})),placeholder:"Describe the damage affecting items in this receiving...",className:"min-h-[60px]"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"shared-notes",className:"text-sm font-medium",children:"Notes (applied to all items)"}),e.jsx(ue,{id:"shared-notes",value:r.globalNotes,onChange:s=>u(t=>({...t,globalNotes:s.target.value})),placeholder:"Optional notes for all items in this receiving batch...",className:"min-h-[60px]"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsx(N,{className:"text-sm font-medium text-slate-700",children:"Receiving Items"}),e.jsxs(y,{type:"button",variant:"outline",size:"sm",onClick:ye,className:"text-green-600 border-green-200 hover:bg-green-50 self-start sm:self-auto",children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 2fr 0.5fr",gap:"12px"},children:[e.jsx("div",{className:"bg-slate-50 border-b px-4 py-3 text-sm font-medium text-slate-700",children:"SKU"}),e.jsx("div",{className:"bg-slate-50 border-b px-4 py-3 text-sm font-medium text-slate-700",children:"Quantity"}),e.jsx("div",{className:"bg-slate-50 border-b px-4 py-3 text-sm font-medium text-slate-700",children:"Unit Cost"}),e.jsx("div",{className:"bg-slate-50 border-b px-4 py-3 text-sm font-medium text-slate-700",children:"Notes"}),e.jsx("div",{className:"bg-slate-50 border-b px-4 py-3 text-sm font-medium text-slate-700 text-center",children:"Actions"}),d.map((s,t)=>{const l=Object.keys(f).filter(n=>n.startsWith(`line-${s.id}`)).length>0;return e.jsxs(fe.Fragment,{children:[e.jsx("div",{className:`px-4 py-3 min-h-[60px] ${l?"bg-red-50":""} ${t>0?"border-t":""}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Pe,{id:`sku-${s.id}`,skus:o,value:s.skuId,onChange:n=>M(s.id,{skuId:n}),placeholder:"Select SKU",error:f[`line-${s.id}-sku`]}),f[`line-${s.id}-sku`]&&e.jsxs("div",{className:"text-xs text-red-600 flex items-start gap-1 min-h-[16px] leading-tight",children:[e.jsx(O,{className:"h-3 w-3 shrink-0 mt-0.5"}),e.jsx("span",{className:"break-words",children:f[`line-${s.id}-sku`]})]})]})}),e.jsx("div",{className:`px-4 py-3 min-h-[60px] ${l?"bg-red-50":""} ${t>0?"border-t":""}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{id:`qty-${s.id}`,type:"number",step:"any",min:"0",value:s.qty||"",onChange:n=>{const k=Number.isNaN(parseFloat(n.target.value))?0:parseFloat(n.target.value);M(s.id,{qty:Math.max(0,k)})},className:`h-9 flex-1 ${f[`line-${s.id}-qty`]?"border-red-500":""}`,placeholder:"0"}),e.jsx("span",{className:"text-xs text-slate-500 min-w-[24px] text-center",children:s.skuId&&o.find(n=>n.id===s.skuId)?.unit||""})]}),f[`line-${s.id}-qty`]&&e.jsxs("div",{className:"text-xs text-red-600 flex items-start gap-1 min-h-[16px] leading-tight",children:[e.jsx(O,{className:"h-3 w-3 shrink-0 mt-0.5"}),e.jsx("span",{className:"break-words",children:f[`line-${s.id}-qty`]})]})]})}),e.jsx("div",{className:`px-4 py-3 min-h-[60px] ${l?"bg-red-50":""} ${t>0?"border-t":""}`,children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ve,{id:`cost-${s.id}`,value:s.unitCost,onChange:n=>M(s.id,{unitCost:n}),error:f[`line-${s.id}-cost`],placeholder:"$0.00"}),f[`line-${s.id}-cost`]&&e.jsxs("div",{className:"text-xs text-red-600 flex items-start gap-1 min-h-[16px] leading-tight",children:[e.jsx(O,{className:"h-3 w-3 shrink-0 mt-0.5"}),e.jsx("span",{className:"break-words",children:f[`line-${s.id}-cost`]})]})]})}),e.jsx("div",{className:`px-4 py-3 min-h-[60px] ${l?"bg-red-50":""} ${t>0?"border-t":""}`,children:e.jsx("div",{className:"h-9 flex items-center",children:e.jsx(D,{value:s.notes,onChange:n=>M(s.id,{notes:n.target.value}),placeholder:"Optional notes",className:"h-9 w-full"})})}),e.jsx("div",{className:`px-4 py-3 min-h-[60px] ${l?"bg-red-50":""} ${t>0?"border-t":""} flex justify-center items-start pt-6`,children:e.jsx(y,{type:"button",variant:"outline",size:"sm",onClick:()=>ke(s.id),disabled:d.length<=1,className:"text-red-600 border-red-200 hover:bg-red-50 h-9 w-9 p-0",children:e.jsx(qe,{className:"h-4 w-4"})})})]},s.id)})]})})}),e.jsx("div",{className:"bg-slate-50 p-3 rounded-lg text-sm",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-slate-600",children:["Total Items: ",d.filter(s=>s.skuId&&s.qty>0).length]}),e.jsxs("span",{className:"text-slate-600",children:["Total Value: $",d.filter(s=>s.skuId&&s.qty>0).reduce((s,t)=>s+t.qty*t.unitCost,0).toFixed(2)]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsx("div",{className:"text-sm text-slate-500",children:R&&"Processing items..."}),e.jsx("div",{className:"flex gap-2",children:e.jsx(y,{type:"button",variant:"outline",onClick:()=>E(!0),disabled:R||d.filter(s=>s.skuId&&s.qty>0).length===0,className:"bg-blue-600 text-white hover:bg-blue-700",children:R?"Processing...":`Process ${d.filter(s=>s.skuId&&s.qty>0).length} Items`})})]})]})]}),L&&ce.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50",role:"presentation",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30","aria-hidden":"true",onClick:()=>E(!1)}),e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-[min(100%,640px)]",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-batch-title",ref:K,children:e.jsxs(T,{className:"rounded-2xl shadow-2xl bg-white ring-1 ring-black/10",children:[e.jsx(V,{children:e.jsx(A,{id:"confirm-batch-title",children:"Confirm Multi-SKU Receiving"})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Date:"})," ",r.date]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Vendor:"})," ",r.vendor||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Packing Slip:"})," ",r.packingSlip||"-"]}),r.isDamaged&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-700",children:"Damage:"})," Yes - ",r.damageDescription||"No description"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-sm",children:["Items to Process (",d.filter(s=>s.skuId&&s.qty>0).length,"):"]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(oe,{children:[e.jsx(xe,{children:e.jsxs(I,{className:"bg-slate-50",children:[e.jsx(b,{className:"text-xs",children:"SKU"}),e.jsx(b,{className:"text-xs text-right",children:"Qty"}),e.jsx(b,{className:"text-xs text-right",children:"Cost"}),e.jsx(b,{className:"text-xs text-right",children:"Value"})]})}),e.jsxs(me,{children:[d.filter(s=>s.skuId&&s.qty>0).map(s=>e.jsxs(I,{className:"text-xs",children:[e.jsx(j,{children:s.skuId}),e.jsx(j,{className:"text-right",children:s.qty}),e.jsxs(j,{className:"text-right",children:["$",s.unitCost.toFixed(2)]}),e.jsxs(j,{className:"text-right",children:["$",(s.qty*s.unitCost).toFixed(2)]})]},s.id)),e.jsxs(I,{className:"bg-slate-50 font-medium text-xs",children:[e.jsx(j,{children:"Total"}),e.jsx(j,{className:"text-right",children:d.filter(s=>s.skuId&&s.qty>0).reduce((s,t)=>s+t.qty,0)}),e.jsx(j,{}),e.jsxs(j,{className:"text-right",children:["$",d.filter(s=>s.skuId&&s.qty>0).reduce((s,t)=>s+t.qty*t.unitCost,0).toFixed(2)]})]})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(y,{variant:"outline",onClick:()=>E(!1),"data-modal-initial":"true",children:"Cancel"}),e.jsx(y,{onClick:()=>{E(!1),Se()},disabled:R,children:R?"Processing...":"Confirm & Process All"})]})]})]})})]}),document.body),we&&ae.length>0&&ce.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50",role:"presentation",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30","aria-hidden":"true",onClick:()=>W(!1)}),e.jsx("div",{className:"absolute left-1/2 top-24 -translate-x-1/2 w-[min(100%,640px)]",role:"dialog","aria-modal":"true","aria-labelledby":"batch-results-title",children:e.jsxs(T,{className:"rounded-2xl shadow-2xl bg-white ring-1 ring-black/10",children:[e.jsx(V,{children:e.jsx(A,{id:"batch-results-title",children:"Processing Results"})}),e.jsxs(B,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:ae.map((s,t)=>e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg text-sm ${s.success?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[e.jsx("span",{className:`w-5 h-5 rounded-full flex items-center justify-center text-xs ${s.success?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:s.success?"✓":"✗"}),e.jsxs("span",{className:"flex-1",children:[e.jsx("strong",{children:s.line.skuId})," - ",s.line.qty," units",s.error&&e.jsxs("div",{className:"text-xs mt-1",children:["Error: ",s.error]})]})]},s.line.id))}),e.jsx("div",{className:"flex justify-end gap-2 pt-2",children:e.jsx(y,{onClick:()=>W(!1),children:"Close"})})]})]})})]}),document.body)]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(ge,{title:"Recent RAW layers (FIFO)",icon:e.jsx(Ee,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs(oe,{children:[e.jsx(xe,{children:e.jsxs(I,{children:[e.jsx(b,{children:"Layer ID"}),e.jsx(b,{children:"Date"}),e.jsx(b,{children:"Remaining qty"}),e.jsx(b,{children:"Unit cost"})]})}),e.jsxs(me,{children:[(x[w]||[]).slice(0,3).map(s=>e.jsxs(I,{children:[e.jsx(j,{children:s.id}),e.jsx(j,{children:typeof s.date=="string"?s.date:new Date(s.date).toLocaleDateString()}),e.jsx(j,{children:s.remaining}),e.jsx(j,{children:U(s.cost)})]},s.id)),(!w||(x[w]||[]).length===0)&&e.jsx(I,{children:e.jsx(j,{colSpan:4,className:"text-sm text-slate-500",children:"Select a SKU to view its recent layers."})})]})]})})}),e.jsx("div",{className:"space-y-4",children:e.jsx(ge,{title:"Recent submissions",icon:e.jsx(he,{className:"h-5 w-5 text-slate-500"}),children:e.jsxs("div",{className:"space-y-2",children:[ne.map((s,t)=>e.jsxs("div",{className:"p-3 rounded-xl border border-dashed",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm",children:[s.ref," — ",s.skuOrName]}),e.jsx(de,{variant:"secondary",children:"RECEIVED"})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:[new Date(s.datetime).toLocaleDateString()," • ",s.qty," units • ",U(s.value)]})]},`${s.datetime}-${t}`)),ne.length===0&&e.jsx("div",{className:"p-3 rounded-xl border border-dashed",children:e.jsx("p",{className:"text-sm text-slate-500",children:"No recent submissions."})})]})})})]})]})}export{es as default};
